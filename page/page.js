"use strict";(()=>{var U="\u0417\u0430\u0433\u0440\u0443\u0436\u0430\u0435\u043C...",F="<br/>(\u043E\u0431\u043D\u043E\u0432\u0438\u0442\u0435 \u0440\u0430\u0441\u0448\u0438\u0440\u0435\u043D\u0438\u0435/\u0441\u0430\u0439\u0442)",fe="\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0445\u043E\u0442\u044F \u0431\u044B 3 \u0441\u0438\u043C\u0432\u043E\u043B\u0430 =]",ve='<span class="error">\u041D\u0435 \u043F\u043E\u043D\u044F\u0442\u043D\u043E, \u0447\u0442\u043E \u044D\u0442\u043E \u0442\u0430\u043A\u043E\u0435 :|</span>'+F,G="\u041E\u0442\u0437\u044B\u0432\u044B \u043F\u0440\u0438\u0448\u043B\u0438 \u0441\u043B\u043E\u043C\u0430\u043D\u043D\u044B\u0435 =("+F,j="\u0420\u0435\u0437\u0443\u043B\u044C\u0442\u0430\u0442\u044B \u043F\u0440\u0438\u0448\u043B\u0438 \u0441\u043B\u043E\u043C\u0430\u043D\u043D\u044B\u0435 =("+F,he="\u041E\u0442\u0437\u044B\u0432\u044B \u043E\u0442\u0441\u0443\u0442\u0441\u0442\u0432\u0443\u044E\u0442 \\(O_o)/";function X(e){switch(e){case 0:return'<span class="error">\u0421\u0435\u0440\u0432\u0435\u0440 \u0441 \u043E\u0442\u0437\u044B\u0432\u0430\u043C\u0438 \u043D\u0435\u0434\u043E\u0441\u0442\u0443\u043F\u0435\u043D =(</span>';case 401:return"\u0421\u043D\u0430\u0447\u0430\u043B\u0430 \u0432\u043E\u0439\u0434\u0438\u0442\u0435, \u044D\u0442\u043E \u0431\u044B\u0441\u0442\u0440\u043E =)";case 404:return"\u041E\u0442\u0437\u044B\u0432\u044B \u043E\u0442\u0441\u0443\u0442\u0441\u0442\u0432\u0443\u044E\u0442 \\(O_o)/";default:return`\u0421\u0435\u0440\u0432\u0435\u0440 \u043F\u0440\u0438\u0441\u043B\u0430\u043B "${e}" \u0432\u043C\u0435\u0441\u0442\u043E \u043E\u0442\u0437\u044B\u0432\u043E\u0432 =(`}}function P(e){switch(e){case 0:return'<span class="error">\u0421\u0435\u0440\u0432\u0435\u0440 \u0441 \u043E\u0442\u0437\u044B\u0432\u0430\u043C\u0438 \u043D\u0435\u0434\u043E\u0441\u0442\u0443\u043F\u0435\u043D =(</span>';case 401:return"\u0421\u043D\u0430\u0447\u0430\u043B\u0430 \u0432\u043E\u0439\u0434\u0438\u0442\u0435, \u044D\u0442\u043E \u0431\u044B\u0441\u0442\u0440\u043E =)";case 404:return"\u041D\u0438\u0447\u0435\u0433\u043E \u043D\u0435 \u043D\u0430\u0439\u0434\u0435\u043D\u043E \\(O_o)/";default:return`\u0421\u0435\u0440\u0432\u0435\u0440 \u043F\u0440\u0438\u0441\u043B\u0430\u043B "${e}" \u0432\u043C\u0435\u0441\u0442\u043E \u0440\u0435\u0437\u0443\u043B\u044C\u0442\u0430\u0442\u043E\u0432 \u043F\u043E\u0438\u0441\u043A\u0430 =(`}}function ge(e,t){return t?`${t} (${e})`:`${e}`}var be={teacher:"\u{1F468}\u200D\u{1F3EB}",subject:"\u{1F4DA}",add:"\u2795"},Te=`\u042D\u0442\u043E \u0430\u0432\u0442\u043E\u0440\u0438\u0437\u0430\u0446\u0438\u044F \u043F\u043E <b>ID.ITMO</b> \u0447\u0435\u0440\u0435\u0437 \u043F\u0440\u043E\u043A\u0441\u0438.<br/>
\u041D\u0430\u0436\u0438\u043C\u0430\u044F \u043A\u043D\u043E\u043F\u043A\u0443 "\u0412\u0445\u043E\u0434" \u0432\u044B \u0434\u0430\u0451\u0442\u0435 \u0441\u043E\u0433\u043B\u0430\u0441\u0438\u0435 \u043D\u0430 <b>\u043E\u0431\u0440\u0430\u0431\u043E\u0442\u043A\u0443 \u043F\u0435\u0440\u0441\u043E\u043D\u0430\u043B\u044C\u043D\u044B\u0445 \u0434\u0430\u043D\u043D\u044B\u0445</b>:<br/>
<i>\u0421\u0430\u0439\u0442 \u043E\u0431\u0440\u0430\u0431\u0430\u0442\u044B\u0432\u0430\u0435\u0442 \u0443\u043D\u0438\u043A\u0430\u043B\u044C\u043D\u044B\u0439 \u0438\u0434\u0435\u043D\u0442\u0438\u0444\u0438\u043A\u0430\u0442\u043E\u0440 \u043F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u0435\u043B\u044F (ISU) \u0434\u043B\u044F \u043F\u0440\u0435\u0434\u043E\u0442\u0432\u0440\u0430\u0449\u0435\u043D\u0438\u044F \u043D\u0430\u043A\u0440\u0443\u0442\u043E\u043A \u0438 \u043E\u0431\u0435\u0441\u043F\u0435\u0447\u0435\u043D\u0438\u044F \u0440\u0430\u0431\u043E\u0442\u044B \u0441\u0435\u0440\u0432\u0438\u0441\u0430. <br/>
\u0414\u0430\u043D\u043D\u044B\u0435 \u043D\u0435 \u043F\u0435\u0440\u0435\u0434\u0430\u044E\u0442\u0441\u044F \u0442\u0440\u0435\u0442\u044C\u0438\u043C \u043B\u0438\u0446\u0430\u043C. \u041F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u0435\u043B\u044C \u043C\u043E\u0436\u0435\u0442 \u0437\u0430\u043F\u0440\u043E\u0441\u0438\u0442\u044C \u0443\u0434\u0430\u043B\u0435\u043D\u0438\u0435 \u0441\u0432\u043E\u0438\u0445 \u0434\u0430\u043D\u043D\u044B\u0445.</i>
`,Le="\u041D\u0435\u0432\u0435\u0440\u043D\u044B\u0435 \u043B\u043E\u0433\u0438\u043D \u0438\u043B\u0438 \u043F\u0430\u0440\u043E\u043B\u044C!",xe="\u041F\u0440\u043E\u0432\u0435\u0440\u044C\u0442\u0435 \u043B\u043E\u0433\u0438\u043D \u0438 \u043F\u0430\u0440\u043E\u043B\u044C! \u041F\u0440\u043E\u0446\u0435\u0441\u0441 \u0430\u0432\u0442\u043E\u0440\u0438\u0437\u0430\u0446\u0438\u0438 \u0431\u044B\u043B \u043D\u0430\u0440\u0443\u0448\u0435\u043D",D="\u0412\u0445\u043E\u0434",ye="\u0412\u0445\u043E\u0434 \u231B",we='<span class="error">\u{1F494} \u0412\u044B\u0439\u0442\u0438 \u0438\u0437 \u0430\u043A\u043A\u0430\u0443\u043D\u0442\u0430</span>',Me="\u{1F4DD} \u041D\u0430\u043F\u0438\u0441\u0430\u0442\u044C \u043E\u0442\u0437\u044B\u0432",He="\u{1F4CB} \u041C\u043E\u0434\u0435\u0440\u0430\u0446\u0438\u044F",I="\u041F\u043E\u0438\u0441\u043A \u043E\u0442\u0437\u044B\u0432\u043E\u0432",ke="\u0412\u0445\u043E\u0434",Se="\u041D\u043E\u0432\u044B\u0439 \u043E\u0442\u0437\u044B\u0432",J="\u041C\u043E\u0434\u0435\u0440\u0430\u0446\u0438\u044F",Ce={delayed:"\u043D\u0430 \u0440\u0430\u0441\u0441\u043C\u043E\u0442\u0440\u0435\u043D\u0438\u0438",accepted:"\u043E\u043F\u0443\u0431\u043B\u0438\u043A\u043E\u0432\u0430\u043D",rejected:"\u043E\u0442\u043A\u043B\u043E\u043D\u0451\u043D"};function $e(){return`
        <div class="category">
            <h3 class="category-title">\u0410\u043D\u0433\u043B\u0438\u0439\u0441\u043A\u0438\u0439</h3>
            <div class="tiles-container">
                <div class="tile orange" data-id="101">A1</div>
                <div class="tile orange" data-id="102">A2</div>
                <div class="tile orange" data-id="103">B1.1</div>
                <div class="tile orange" data-id="104">B1.2</div>
                <div class="tile orange" data-id="105">B2</div>
                <div class="tile orange" data-id="106">C1</div>
                <div class="tile orange" data-id="107">C2</div>
            </div>
        </div>

        <div class="category">
            <h3 class="category-title">\u041E\u0431\u0449\u0438\u0435 \u043F\u0440\u0435\u0434\u043C\u0435\u0442\u044B</h3>
            <div class="tiles-container">
                <div class="tile green" data-id="35">\u0424\u0438\u0437\u043A\u0443\u043B\u044C\u0442\u0443\u0440\u0430</div>
                <div class="tile green" data-id="2">\u0424\u0438\u043B\u043E\u0441\u043E\u0444\u0438\u044F</div>
                <div class="tile green" data-id="9">\u041A\u043E\u043C\u043C\u0443\u043D\u0438\u043A\u0430\u0446\u0438\u0438 \u0438 \u043A\u043E\u043C\u0430\u043D\u0434\u043E\u043E\u0431\u0440\u0430\u0437\u043E\u0432\u0430\u043D\u0438\u0435</div>
                <div class="tile green" data-id="47">\u0422\u0435\u0445\u043D\u0438\u043A\u0438 \u043F\u0443\u0431\u043B\u0438\u0447\u043D\u044B\u0445 \u0432\u044B\u0441\u0442\u0443\u043F\u043B\u0435\u043D\u0438\u0439</div>
            </div>
        </div>

<!--        <div class="category">-->
<!--            <h3 class="category-title">\u041C\u0430\u0442\u0435\u043C\u0430\u0442\u0438\u043A\u0430</h3>-->
<!--            <div class="tiles-container">-->
<!--                <div class="tile red">\u041C\u0430\u0442\u0430\u043D\u0430\u043B\u0438\u0437</div>-->
<!--                <div class="tile red">\u041C\u0430\u0442\u0430\u043D\u0430\u043B\u0438\u0437 (\u043F\u0440\u043E\u0434)</div>-->
<!--                <div class="tile red">\u0410\u043B\u0433\u0435\u0431\u0440\u0430</div>-->
<!--                <div class="tile red">\u0410\u043B\u0433\u0435\u0431\u0440\u0430 (\u043F\u0440\u043E\u0434)</div>-->
<!--                <div class="tile red">\u0414\u0438\u0441\u043A\u0440\u0435\u0442\u043D\u0430\u044F \u043C\u0430\u0442\u0435\u043C\u0430\u0442\u0438\u043A\u0430</div>-->
<!--                <div class="tile red">\u0422\u0435\u043E\u0440\u0432\u0435\u0440</div>-->
<!--                <div class="tile red">\u041C\u0430\u0442\u0441\u0442\u0430\u0442</div>-->
<!--                <div class="tile red">\u0414\u0413\u041C\u0410</div>-->
<!--                <div class="tile red">\u0422\u0424\u041A\u041F</div>-->
<!--                <div class="tile red">\u041E\u0441\u043D\u043E\u0432\u044B \u0442\u0435\u043E\u0440\u0438\u0438 \u0438\u0433\u0440</div>-->
<!--                <div class="tile red">\u0414\u0438\u0444\u0444\u0435\u0440\u0435\u043D\u0446\u0438\u0430\u043B\u044C\u043D\u044B\u0435 \u0443\u0440\u0430\u0432\u043D\u0435\u043D\u0438\u044F</div>-->
<!--                <div class="tile red">\u0427\u0438\u0441\u043B\u0435\u043D\u043D\u044B\u0435 \u043C\u0435\u0442\u043E\u0434\u044B \u043C\u043E\u0434\u0435\u043B\u0438\u0440\u043E\u0432\u0430\u043D\u0438\u044F</div>-->
<!--            </div>-->
<!--        </div>-->

<!--        <div class="category">-->
<!--            <h3 class="category-title">\u041F\u0418\u041D</h3>-->
<!--            <div class="tiles-container">-->
<!--                <div class="tile yellow">\u041F\u0440\u043E\u0433\u0440\u0430\u043C\u043C\u0438\u0440\u043E\u0432\u0430\u043D\u0438\u0435</div>-->
<!--                <div class="tile yellow">\u0410\u043B\u0433\u043E\u0441\u044B</div>-->
<!--                <div class="tile yellow">\u0418\u043D\u0444\u043E\u043A\u043E\u043C</div>-->
<!--                <div class="tile yellow">\u041F\u0438\u0420\u0411\u0414</div>-->
<!--                <div class="tile yellow">\u041E\u041E\u041F</div>-->
<!--            </div>-->
<!--        </div>-->

<!--        <div class="category">-->
<!--            <h3 class="category-title">\u0412\u0422</h3>-->
<!--            <div class="tiles-container">-->
<!--                <div class="tile purple">\u0414\u0438\u0441\u043A\u0440\u0435\u0442\u043A\u0430 (\u0431\u0430\u0437\u0430\xB3)</div>-->
<!--                <div class="tile purple">\u0414\u0438\u0441\u043A\u0440\u0435\u0442\u043A\u0430 (\u043F\u0440\u043E\u0434)</div>-->
<!--                <div class="tile purple">\u041E\u041F\u0414</div>-->
<!--                <div class="tile purple">\u041F\u0440\u043E\u0433\u0440\u0430\u043C\u043C\u0438\u0440\u043E\u0432\u0430\u043D\u0438\u0435</div>-->
<!--                <div class="tile purple">\u0418\u043D\u0444\u043E\u0440\u043C\u0430\u0442\u0438\u043A\u0430</div>-->
<!--                <div class="tile purple">\u0411\u0414</div>-->
<!--                <div class="tile purple">\u042F\u041F\u044B</div>-->
<!--                <div class="tile purple">web</div>-->
<!--                <div class="tile purple">\u0410\u0440\u0445 \u042D\u0412\u041C</div>-->
<!--                <div class="tile purple">\u0418\u0411</div>-->
<!--            </div>-->
<!--        </div>-->

<!--        <div class="category">-->
<!--            <h3 class="category-title">\u0418\u0441\u0442\u043E\u0440\u0438\u044F</h3>-->
<!--            <div class="tiles-container">-->
<!--                <div class="tile blue">\u0418\u0441\u0442\u043E\u0440\u0438\u044F \u0440\u0443\u0441\u0441\u043A\u043E\u0439 \u043A\u0443\u043B\u044C\u0442\u0443\u0440\u044B \u0432 \u043A\u043E\u043D\u0442\u0435\u043A\u0441\u0442\u0435 \u043C\u0438\u0440\u043E\u0432\u043E\u0439 \u043A\u0443\u043B\u044C\u0442\u0443\u0440\u044B</div>-->
<!--                <div class="tile blue">\u0420\u043E\u0441\u0441\u0438\u044F \u0432 \u0438\u0441\u0442\u043E\u0440\u0438\u0438 \u0441\u043E\u0432\u0440\u0435\u043C\u0435\u043D\u043D\u044B\u0445 \u043C\u0435\u0436\u0434\u0443\u043D\u0430\u0440\u043E\u0434\u043D\u044B\u0445 \u043E\u0442\u043D\u043E\u0448\u0435\u043D\u0438\u0439</div>-->
<!--                <div class="tile blue">\u0420\u0435\u0444\u043E\u0440\u043C\u044B \u0438 \u0440\u0435\u0444\u043E\u0440\u043C\u0430\u0442\u043E\u0440\u044B \u0432 \u0438\u0441\u0442\u043E\u0440\u0438\u0438 \u0420\u043E\u0441\u0441\u0438\u0438</div>-->
<!--                <div class="tile blue">\u0418\u0441\u0442\u043E\u0440\u0438\u044F \u0440\u043E\u0441\u0441\u0438\u0439\u0441\u043A\u043E\u0439 \u043D\u0430\u0443\u043A\u0438 \u0438 \u0442\u0435\u0445\u043D\u0438\u043A\u0438</div>-->
<!--                <div class="tile blue">\u0418\u0441\u0442\u043E\u0440\u0438\u044F \u0420\u043E\u0441\u0441\u0438\u0438 \u0438 \u043C\u0438\u0440\u0430 \u0432 \u0425\u0425 \u0432\u0435\u043A\u0435</div>-->
<!--                <div class="tile blue">\u0421\u043E\u0446\u0438\u0430\u043B\u044C\u043D\u0430\u044F \u0438\u0441\u0442\u043E\u0440\u0438\u044F \u0420\u043E\u0441\u0441\u0438\u0438</div>-->
<!--            </div>-->
<!--        </div>-->

        <div class="category">
            <h3 class="category-title">\u041F\u0440\u0435\u0434\u043B\u043E\u0436\u0435\u043D\u0438\u044F? \u041F\u043E\u0436\u0435\u043B\u0430\u043D\u0438\u044F?</h3>
            <a href="https://t.me/reviews_ext">\u041D\u0430\u043F\u0438\u0448\u0438\u0442\u0435 \u0432 \u0434\u0438\u0440\u0435\u043A\u0442</a>
        </div>
    `}function Ee(e,t,n,r,i,s){let a=document.createElement("div");return a.appendChild(ut(e,t,n,i,s)),a.appendChild(dt(r)),a}function ut(e,t,n,r,i){let s=document.createElement("div");s.classList.add("reviews-menu");let a=document.createElement("button");if(a.classList.add("reviews-menu-item"),a.innerHTML=Me,a.addEventListener("click",r),s.appendChild(a),t){let c=document.createElement("button");c.classList.add("reviews-menu-item"),c.innerHTML=He,c.addEventListener("click",i),s.appendChild(c)}if(e){let c=document.createElement("button");c.classList.add("reviews-menu-item"),c.innerHTML=we,c.addEventListener("click",n),s.appendChild(c)}return s}function dt(e){let t=document.createElement("div");return t.innerHTML=$e(),t.addEventListener("click",n=>{if(n.target.classList.contains("tile")){let r=n.target.getAttribute("data-id");e(r,"subject")}}),t}function k(e,t){let n=document.createElement("div");return n.className="search-list",e.results.forEach(r=>{let i=document.createElement("div");i.className="search-item",i.innerHTML=`
            ${be[r.type]||""}
            ${r.title}
            <span class="search-id">${r.id}</span>
        `,i.addEventListener("click",async()=>t(r.id,r.type,r.title)),n.appendChild(i)}),n}function N(e){try{let t=e.split(".")[1].replace(/-/g,"+").replace(/_/g,"/"),n=atob(t),r=Uint8Array.from(n,s=>s.charCodeAt(0)),i=new TextDecoder("utf-8").decode(r);return JSON.parse(i)}catch(t){return console.error("\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0430\u0440\u0441\u0438\u043D\u0433\u0430 JWT",t),null}}function z(e){if(!e)return-1/0;let t=e.toLowerCase().match(/^до\s+(\d{4})$/);if(t){let[,l]=t;return new Date(Number(l),0,1,0,0).getTime()}let n=e.match(/(\d{2}):(\d{2})\s+(\d{2})\.(\d{2})\.(\d{4})/);if(!n)return-1/0;let[,r,i,s,a,c]=n;return new Date(Number(c),Number(a)-1,Number(s),Number(r),Number(i)).getTime()}function K(e,t,n={}){let{days:r=1,path:i="/",sameSite:s="Lax",secure:a=!1}=n,c=`${encodeURIComponent(e)}=${encodeURIComponent(t)}`;r&&(c+=`; max-age=${r*86400}`),c+=`; path=${i}`,c+=`; SameSite=${s}`,a&&(c+="; Secure"),document.cookie=c}function Y(e){let t=document.cookie.split("; ").find(n=>n.startsWith(encodeURIComponent(e)+"="));return t?decodeURIComponent(t.split("=")[1]):null}function S(e){return typeof e!="string"?"":e.normalize("NFKC").replace(/[\s\uFEFF\xA0]+/g," ").trim()}var x=!1,b=null,g=null,R=0,pt=300;function Ae(){return b!==null}function je(e,t){b=e,g=t;let n=N(g);n?.exp&&(R=n.exp||0)}function Pe(){return Date.now()>=R*1e3-pt*1e3}function B(e){return N(e)?.isu?!0:(console.error("[AUTHP] isu not found"),!1)}function mt(e,t){x=!0,chrome.runtime?.id&&chrome.storage.local.set({refresh_token:e,access_token:t},()=>{let n=chrome.runtime.lastError;n&&!n.message.includes("Extension context invalidated")?console.error(n):(je(e,t),console.log("[AUTHP] tokens saved successfully"))})}function ft(){x=!0,chrome.storage.local.remove(["refresh_token","access_token"]),b=null,g=null,R=0}function V(e,t){x=!1,K("refresh_token",e,{secure:!1}),K("access_token",t,{secure:!1})}function W(){return x=!1,new Promise((e,t)=>{let n=Y("refresh_token"),r=Y("access_token");if(n&&r){je(n,r);let i=N(r);i?e(i):t()}else t()})}function Q(){x=!1,document.cookie="refresh_token=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;",document.cookie="access_token=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;",b=null,g=null,R=0}function Ie(e,t){x?mt(e,t):V(e,t)}function Ne(){x?ft():Q()}async function f(e,t,n={},r=null){let i=new URL(t,"https://reviews.work.gd/"),s={method:e.toUpperCase(),headers:{"Content-Type":"application/json"},signal:r?.signal};if(b)try{if(!g||Pe()){let a=new URL("/authp/refresh","https://reviews.work.gd/"),c=await fetch(a,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({refresh_token:b})});if(c.ok){let m=(await c.json())?.access_token;m&&B(m)&&Ie(b,m)}else console.error("[API] Refresh status code "+c.status),Ne()}g&&(s.headers.token=g)}catch(a){console.error("[API] Unable to refresh the token",a)}return s.method==="GET"?Object.entries(n).forEach(([a,c])=>{i.searchParams.set(a,c.toString())}):s.body=JSON.stringify(n),new Promise((a,c)=>{fetch(i,s).then(async l=>{if(l.ok){console.log("[API] fetch resolved");let m=await l.text();a(m?JSON.parse(m):{})}else{let m=await l.json().catch(()=>({}));l.status===401||l.status===404?console.info("[API] error details:",m):console.error("[API] error details:",m),c(l.status)}}).catch(l=>{l.name!=="AbortError"?(console.error("[API] network error:",l),c(0)):console.log("[API] fetch aborted")})})}async function q(e,t,n=null){return console.log(`[API] send /search for "${e}"`),await f("GET","/search",n===null?{query:e}:{query:e,strainer:n},t)}async function Re(e){return console.log(`[API] send /teacher for "${e}"`),await f("GET",`/teacher/${e}`,{})}async function Be(e){return console.log(`[API] send /subject for "${e}"`),await f("GET",`/subject/${e}`,{})}async function qe(e,t){return console.log(`[API] send /teacher/${e}/rate ${t}`),await f("POST",`/teacher/${e}/rate`,{user_rating:t})}async function Z(e,t){return console.log(`[API] send /comment/${e}/vote ${t}`),await f("POST",`/comment/${e}/vote`,{user_karma:t})}async function _e(e,t){return console.log("[API] send /authp/login"),await f("POST","/authp/login",{username:e,password:t})}async function Oe(){return console.log("[API] send GET /moderator"),await f("GET","/moderator")}async function Ue(e){return console.log("[API] send POST /suggestion"),await f("POST","/suggestion",e)}async function Fe(){return console.log("[API] send GET /suggestion"),await f("GET","/suggestion")}async function Ge(e){return console.log(`[API] send GET /suggestion/${e}`),await f("GET",`/suggestion/${e}`)}async function Xe(e,t){return console.log(`[API] send POST /suggestion/${e}/commit`),await f("POST",`/suggestion/${e}/commit`,t)}async function De(e,t="rejected"){return console.log(`[API] send POST /suggestion/${e}/cancel status=${t}`),await f("POST",`/suggestion/${e}/cancel`,{status:t})}function te(e,t){let n=document.createElement("div");n.classList.add("comments-wrap");let r=Je(e,t);if(e.length>1){let i=gt(e);i.addEventListener("change",s=>{let a=parseInt(s.target.value);console.log(`[UI] sorting model ${a}`);let c=Je(e,t,a);n.replaceChild(c,r),r=c}),n.appendChild(i)}return n.appendChild(r),n}function Je(e,t,n=0){let r=document.createElement("div");return r.classList.add("comments"),bt(e,n).map(s=>r.append(vt(s,t))),r}function vt(e,t){let n=document.createElement("div");return n.classList.add("comment"),n.innerHTML=`
        <div class="comment-head">
            \u041E\u0442\u0437\u044B\u0432 ${e.date}
            ${e?.subject?` \u043F\u043E \u043F\u0440\u0435\u0434\u043C\u0435\u0442\u0443 "${e.subject.title}"`:" "}
            ${e?.source?` \u0438\u0441\u0442\u043E\u0447\u043D\u0438\u043A "<a href="${e.source.link??""}">${e.source.title}</a>"`:""}
        </div>
        <div>${e.text}</div>
    `,n.appendChild(ht(e.id,e.karma,e.user_karma,t)),n}function ht(e,t,n,r){let i=document.createElement("div");i.classList.add("karma");let s=document.createElement("span");s.classList.add("karma-value");let a=document.createElement("button");a.classList.add("karma-btn");let c=document.createElement("button");if(c.classList.add("karma-btn"),r){let l=!1;a.addEventListener("click",async m=>{if(!l)try{l=!0;let H=await Z(e,n===1?0:1);n=H.user_karma,t=H.karma,ee(s,a,c,t,n)}finally{l=!1}}),c.addEventListener("click",async m=>{if(!l)try{let H=await Z(e,n===-1?0:-1);n=H.user_karma,t=H.karma,ee(s,a,c,t,n)}finally{l=!1}})}else a.disabled=!0,c.disabled=!0;return ee(s,a,c,t,n),i.appendChild(a),i.appendChild(s),i.appendChild(c),i}function ee(e,t,n,r,i){i==null&&(i=0),e.innerHTML=r,t.innerHTML=i===1?"\u25B2":"\u25B3",n.innerHTML=i===-1?"\u25BC":"\u25BD"}function gt(){let e=document.createElement("select");return e.name="sort",e.classList.add("comments-dropdown"),e.innerHTML=`
        <option value="0">C \u0432\u044B\u0441\u043E\u043A\u043E\u0439 \u043A\u0430\u0440\u043C\u044B</option>
        <option value="1">\u0421 \u043D\u0438\u0437\u043A\u043E\u0439 \u043A\u0430\u0440\u043C\u044B</option>
        <option value="2">\u0421\u043D\u0430\u0447\u0430\u043B\u0430 \u043D\u043E\u0432\u044B\u0435</option>
        <option value="3">\u0421\u043D\u0430\u0447\u0430\u043B\u0430 \u0441\u0442\u0430\u0440\u044B\u0435</option>`,e}function bt(e,t=0){return[...e].sort((n,r)=>{let i=z(n.date),s=z(r.date),a;switch(t){case 0:return a=r.karma-n.karma,a===0?Number.isNaN(i)||Number.isNaN(s)?0:s-i:a;case 1:return a=n.karma-r.karma,a===0?Number.isNaN(i)||Number.isNaN(s)?0:s-i:a;case 2:return Number.isNaN(i)||Number.isNaN(s)?0:s-i;case 3:return Number.isNaN(i)||Number.isNaN(s)?0:i-s;default:return 0}})}function ne(e,t,n,r){let i=document.createElement("div");i.classList.add("rating-box"),i.innerHTML=ze(e,t,n,r);let s=!1;return i.addEventListener("change",async a=>{if(a.target.name===`rating-${e}`){if(s)return;let c=parseInt(a.target.value);try{s=!0;let l=await qe(e,c);i.innerHTML=ze(e,l.rating,l.user_rating,r)}finally{s=!1}}}),i}function ze(e,t,n,r){n==null&&(n=0);let i=[5,4,3,2,1].map(s=>`
        <input type="radio" 
            id="rate-${e}-${s}" 
            name="rating-${e}" 
            value="${s}" 
            ${n===s?"checked":""}
            ${r?"":"disabled"}>
        <label for="rate-${e}-${s}">\u2605</label>
    `).join("");return`
        <div class="rating-row">
            <span class="rating-title">\u0421\u0440\u0435\u0434\u043D\u044F\u044F \u043E\u0446\u0435\u043D\u043A\u0430:</span>
            <span class="rating-value">${t}</span>
        </div>
        <div class="rating-row">
            <span class="rating-title">\u0412\u0430\u0448\u0430 \u043E\u0446\u0435\u043D\u043A\u0430:</span>
            <div class="rating">${i}</div>
        </div>
    `}function re(e){let t=e.map(r=>`
        <div class="summary">
            <span class="summary-title">${r.title??""}</span>: 
            <span class="summary-value">${r.value??""}</span>
        </div>
    `).join(""),n=document.createElement("div");return n.classList.add("summaries"),n.innerHTML=t,n}function C(e,t){if(!e||!Array.isArray(e.summaries)||!Array.isArray(e.comments))return null;let n=document.createElement("div");if(n.classList.add("reviews-content-box"),n.appendChild(ne(e.id,e.rating,e?.user_rating,t)),e.summaries.length!==0&&n.appendChild(re(e.summaries)),e.comments.length!==0&&n.appendChild(te(e.comments,t)),e.summaries.length===0&&e.comments.length===0){let r=document.createElement("p");r.classList.add("comment"),r.innerHTML=he,n.appendChild(r)}return n}function Ke(e,t){let n=C(e,t);if(n===null)return null;let r=document.createElement("div");return r.innerHTML=`<h2>${e.name}</h2>`,r.appendChild(n),r}function Ye(e,t){if(!e||!Array.isArray(e.teachers))return null;e.teachers.sort((i,s)=>{let a=s.rating-i.rating;return a===0?s.id-i.id:a});let n=e.teachers.map(i=>C(i,t));if(n.some(i=>i===null))return null;let r=document.createElement("div");return r.innerHTML=`<h2>${e.title}</h2>`,e.teachers.forEach((i,s)=>{let a=document.createElement("details");a.innerHTML=`<summary class="reviews-title">${i.name}</summary>`,a.appendChild(n[s]),r.appendChild(a)}),r}function Ve(e){let t=document.createElement("form");t.classList.add("login-form"),t.innerHTML=`
        <p>${Te}</p>
    
        <input type="email" name="email" placeholder="E-mail" required />
        <input type="password" name="password" placeholder="\u041F\u0430\u0440\u043E\u043B\u044C" required />
    
        <button id="authp-login" type="submit">\u0412\u0445\u043E\u0434</button>
    `;let n=t.querySelector("#authp-login");return t.addEventListener("submit",async r=>{r.preventDefault(),n.disabled=!0,n.innerHTML=ye,_e(t.email.value,t.password.value).then(i=>{let s=i?.refresh_token,a=i?.access_token;if(!s||!a){console.error("[AUTHP] Invalid response",i),n.disabled=!1,n.innerHTML=D;return}B(a)&&(V(s,a),e())}).catch(i=>{alert(i===401?Le:xe+` (\u0441\u0442\u0430\u0442\u0443\u0441 ${i})`),n.disabled=!1,n.innerHTML=D})}),t}function We(e){return{teacher:{input:e.querySelector("#addrev-teacher-input"),reset:e.querySelector("#addrev-teacher-input-reset"),container:e.querySelector("#addrev-teacher-container"),status:e.querySelector("#addrev-teacher-status")},subject:{input:e.querySelector("#addrev-subject-input"),reset:e.querySelector("#addrev-subject-input-reset"),container:e.querySelector("#addrev-subject-container"),status:e.querySelector("#addrev-subject-status")},subs:{input:e.querySelector("#addrev-sub-input"),reset:e.querySelector("#addrev-sub-input-reset"),container:e.querySelector("#addrev-sub-container"),status:e.querySelector("#addrev-sub-status")},comment:{input:e.querySelector("#addrev-comment-input"),counter:e.querySelector("#addrev-comment-char-count")},submit:e.querySelector("#addrev-submit"),cancel:e.querySelector("#addrev-cancel"),exit:e.querySelector("#addrev-exit"),spam:e.querySelector("#addrev-spam")}}function Qe(e){return`
        ${e?`<button id="addrev-spam" class="rev-button-s">
            \u041E\u0442\u043F\u0440\u0430\u0432\u0438\u0442\u044C \u0432 \u0441\u043F\u0430\u043C
        </button>`:""}

        <p class="add-rev-label">* \u0414\u043E\u0431\u0430\u0432\u043B\u0435\u043D\u0438\u0435 \u043D\u043E\u0432\u043E\u0433\u043E \u043E\u0442\u0437\u044B\u0432\u0430, \u0434\u043B\u044F \u043F\u0440\u0435\u043F\u043E\u0434\u0430\u0432\u0430\u0442\u0435\u043B\u044F...</p>
        <div id="addrev-teacher-input-wrapper" class="rev-input-wrapper">
            <label for="addrev-teacher-input">\u0424\u0418\u041E \u043F\u0440\u0435\u043F\u043E\u0434\u0430\u0432\u0430\u0442\u0435\u043B\u044F</label>
            <input type="text" id="addrev-teacher-input" class="rev-input" 
                placeholder="\u0418\u0432\u0430\u043D\u043E\u0432 \u0418\u0432\u0430\u043D \u0418\u0432\u0430\u043D\u043E\u0432\u0438\u0447" 
                maxlength="64"/>
            <button type="reset" id="addrev-teacher-input-reset" class="rev-input-reset">&times;</button>
        </div>
        <div id="addrev-teacher-container"></div>
        <p id="addrev-teacher-status" class="add-rev-status">\u041D\u0438\u043A\u043E\u0433\u043E \u043D\u0435 \u0432\u044B\u0431\u0440\u0430\u043D\u043E</p>
        
        <p class="add-rev-label">* \u041F\u043E \u043A\u0430\u043A\u043E\u043C\u0443 \u043F\u0440\u0435\u0434\u043C\u0435\u0442\u0443 \u0432\u044B \u0435\u0433\u043E \u0437\u043D\u0430\u0435\u0442\u0435? <i>(\u0412\u044B\u0431\u0435\u0440\u0438\u0442\u0435 \u043E\u0441\u043D\u043E\u0432\u043D\u043E\u0439)</i></p>
        <div id="addrev-subject-input-wrapper" class="rev-input-wrapper">
            <label for="addrev-subject-input">\u041D\u0430\u0437\u0432\u0430\u043D\u0438\u0435 \u043F\u0440\u0435\u0434\u043C\u0435\u0442\u0430</label>
            <input type="text" id="addrev-subject-input" class="rev-input" 
            placeholder="\u041C\u0430\u0442\u0435\u043C\u0430\u0442\u0438\u0447\u0435\u0441\u043A\u0438\u0439 \u0430\u043D\u0430\u043B\u0438\u0437" 
            maxlength="64"/>
            <button type="reset" id="addrev-subject-input-reset" class="rev-input-reset">&times;</button>
        </div>
        <div id="addrev-subject-container"></div>
        <p id="addrev-subject-status" class="add-rev-status">\u041D\u0438\u0447\u0435\u0433\u043E \u043D\u0435 \u0432\u044B\u0431\u0440\u0430\u043D\u043E</p>
        
        <p class="add-rev-label">\u041A\u0430\u043A\u0438\u0435 \u0435\u0449\u0435 \u043F\u0440\u0435\u0434\u043C\u0435\u0442\u044B \u0432\u0435\u0434\u0435\u0442? <i>(\u041E\u0442\u043C\u0435\u0442\u044C\u0442\u0435, \u0435\u0441\u043B\u0438 \u0437\u043D\u0430\u0435\u0442\u0435)</i></p>
        <div id="addrev-sub-input-wrapper" class="rev-input-wrapper">
            <label for="addrev-sub-input">\u041D\u0430\u0437\u0432\u0430\u043D\u0438\u0435 \u043F\u0440\u0435\u0434\u043C\u0435\u0442\u0430</label>
            <input type="text" id="addrev-sub-input" class="rev-input" 
                placeholder="\u0410\u043B\u0433\u0435\u0431\u0440\u0430" 
                maxlength="64"/>
            <button type="reset" id="addrev-sub-input-reset" class="rev-input-reset">&times;</button>
        </div>
        <div id="addrev-sub-container"></div>
        <div id="addrev-sub-status">
            <p class="add-rev-status">\u041D\u0438\u0447\u0435\u0433\u043E \u043D\u0435 \u0432\u044B\u0431\u0440\u0430\u043D\u043E</p>
        </div>
                
        <p class="add-rev-label">
            * \u0427\u0442\u043E \u043C\u043E\u0436\u0435\u0442\u0435 \u043E \u043D\u0451\u043C \u0441\u043A\u0430\u0437\u0430\u0442\u044C? <br/>
            <i>\u041A\u0430\u043A \u043E\u0442\u043D\u043E\u0441\u0438\u0442\u044C\u0441\u044F \u043A \u0441\u0442\u0443\u0434\u0435\u043D\u0442\u0430\u043C? \u041A\u0430\u043A \u043F\u0440\u0435\u043F\u043E\u0434\u0430\u0451\u0442? \u0422\u0440\u0443\u0434\u043D\u043E \u043B\u0438 \u0437\u0430\u043A\u0440\u044B\u0442\u044C\u0441\u044F? \u0423\u043A\u0430\u0436\u0438\u0442\u0435 \u0443\u0440\u043E\u0432\u0435\u043D\u044C, \u0435\u0441\u043B\u0438 \u044D\u0442\u043E \u0430\u043D\u0433\u043B\u0438\u0439\u0441\u043A\u0438\u0439.</i>
        </p>
        <div class="comment-textarea-wrapper">
            <label for="addrev-comment-input">\u041A\u043E\u043C\u043C\u0435\u043D\u0442\u0430\u0440\u0438\u0439</label>
            <textarea
                    id="addrev-comment-input"
                    class="comment-input"
                    placeholder="\u041C\u043E\u0436\u043D\u043E \u043F\u0438\u0441\u0430\u0442\u044C \u043A\u0440\u0430\u0442\u043A\u043E (\u043E\u0431\u044B\u0447\u043D\u043E \u043F\u0438\u0448\u0443\u0442 3\u20135 \u043F\u0440\u0435\u0434\u043B\u043E\u0436\u0435\u043D\u0438\u0439)..."
                    maxlength="10000"
            ></textarea>
            <div class="comment-char-counter">
                <span id="addrev-comment-char-count">0</span>/10000
            </div>
        </div>
        <button id="addrev-submit" class="rev-button">
            ${e?"\u0414\u043E\u0431\u0430\u0432\u0438\u0442\u044C \u043E\u0442\u0437\u044B\u0432":"\u041E\u0442\u043F\u0440\u0430\u0432\u0438\u0442\u044C \u0430\u043D\u043E\u043D\u0438\u043C\u043D\u044B\u0439 \u043E\u0442\u0437\u044B\u0432"}
        </button>
        <button id="addrev-cancel" class="rev-button-s">
            ${e?"\u041E\u0442\u043A\u043B\u043E\u043D\u0438\u0442\u044C (\u043D\u0430\u0440\u0443\u0448\u0430\u0435\u0442 \u043F\u0440\u0430\u0432\u0438\u043B\u0430)":"\u041E\u0447\u0438\u0441\u0442\u0438\u0442\u044C"}
        </button>
        ${e?`<button id="addrev-exit" class="rev-button-s">
            \u041E\u0442\u043C\u0435\u043D\u0430
        </button>`:""}
    `}var se=!1,$,E={id:null,teacher:{id:null,title:null},subject:{id:null,title:null},subs:new Map,comment:""},o=structuredClone(E);function ce(e,t=null,n=!1){se=n,$=e;let r=document.createElement("div");r.innerHTML=Qe(se);let i=We(r);return Lt(r,i),t&&(o.id=t.id,o.teacher=t.teacher,o.subject=t.subject,o.comment=t.text,o.subs=new Map(t.subs.map(s=>[s.title,s]))),tt(i),r}var v={teacher:{type:"teacher",controller:void 0,timeout:void 0,value:""},subject:{type:"subject",controller:void 0,timeout:void 0,value:""},subs:{type:"subject",controller:void 0,timeout:void 0,value:""}};function Lt(e,t){e.addEventListener("click",r=>{if(r.target===t.teacher.reset&&(t.teacher.input.value="",t.teacher.container.innerHTML=""),r.target===t.subject.reset&&(t.subject.input.value="",t.subject.container.innerHTML=""),r.target===t.subs.reset&&(t.subs.input.value="",t.subs.container.innerHTML=""),r.target.classList.contains("rev-list-item-reset")){let i=r.target.getAttribute("data-id");o.subs.delete(i),oe(t.subs,o.subs)}se?(r.target===t.submit&&yt(),r.target===t.cancel&&Ze("rejected"),r.target===t.spam&&Ze("spam"),r.target===t.exit&&(o=structuredClone(E),$())):(r.target===t.submit&&xt(),r.target===t.cancel&&Ht(t))});function n(r){if(r.target===t.comment.input){o.comment=t.comment.input.value;let i=t.comment.input.value.length;t.comment.counter.textContent=i.toString();let s=i>=1e4;t.comment.input.classList.toggle("limit-exceeded",s),t.comment.counter.parentElement.classList.toggle("limit-exceeded",s);let a=window.scrollY;t.comment.input.style.height="auto",t.comment.input.style.height=t.comment.input.scrollHeight+"px",window.scrollTo(window.scrollX,a+1e3)}r.target===t.teacher.input&&(v.teacher.value=t.teacher.input.value,clearTimeout(v.teacher.timeout),v.teacher.timeout=setTimeout(()=>{ie(t.teacher,v.teacher,o.teacher,et)},300)),r.target===t.subject.input&&(v.subject.value=t.subject.input.value,clearTimeout(v.subject.timeout),v.subject.timeout=setTimeout(()=>{ie(t.subject,v.subject,o.subject,et)},300)),r.target===t.subs.input&&(v.subs.value=t.subs.input.value,clearTimeout(v.subs.timeout),v.subs.timeout=setTimeout(()=>{ie(t.subs,v.subs,o.subs,wt)},300))}e.addEventListener("input",n),e.addEventListener("keydown",r=>{r.key==="Enter"&&n(r)})}function xt(){if(o.teacher.title===null){alert("\u041F\u043E\u0436\u0430\u043B\u0443\u0439\u0441\u0442\u0430, \u0432\u044B\u0431\u0435\u0440\u0438\u0442\u0435 \u043F\u0440\u0435\u043F\u043E\u0434\u0430\u0432\u0430\u0442\u0435\u043B\u044F =]");return}if(o.subject.title===null){alert("\u041F\u043E\u0436\u0430\u043B\u0443\u0439\u0441\u0442\u0430, \u0432\u044B\u0431\u0435\u0440\u0438\u0442\u0435 \u043E\u0441\u043D\u043E\u0432\u043D\u043E\u0439 \u043F\u0440\u0435\u0434\u043C\u0435\u0442 =]");return}if(S(o.comment).length===0){alert("\u041D\u0435 \u0441\u043B\u0438\u0448\u043A\u043E\u043C \u043B\u0438 \u043C\u0430\u043B\u043E \u0432\u044B \u043D\u0430\u043F\u0438\u0441\u0430\u043B\u0438?)");return}let e={teacher:o.teacher,subject:o.subject,subs:Array.from(o.subs.values()),text:o.comment};Ue(e).then(t=>{alert("\u0421\u043F\u0430\u0441\u0438\u0431\u043E! \u041E\u0442\u0437\u044B\u0432 \u0431\u0443\u0434\u0435\u0442 \u043E\u043F\u0443\u0431\u043B\u0438\u043A\u043E\u0432\u0430\u043D \u043A\u0430\u043A \u0442\u043E\u043B\u044C\u043A\u043E \u043F\u0440\u043E\u0439\u0434\u0451\u0442 \u043C\u043E\u0434\u0435\u0440\u0430\u0446\u0438\u044E =)"),o=structuredClone(E),$()}).catch(t=>{alert(`\u0421\u0435\u0440\u0432\u0435\u0440 \u043E\u0442\u0432\u0435\u0442\u0438\u043B ${t}`)})}function yt(){if(o.id===null&&alert("Suggestion id \u043F\u0443\u0441\u0442\u043E\u0439!"),o.teacher.id===null){alert("\u0412\u044B\u0431\u0435\u0440\u0438\u0442\u0435 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u044E\u0449\u0435\u0433\u043E \u043F\u0440\u0435\u043F\u043E\u0434\u0430\u0432\u0430\u0442\u0435\u043B\u044F");return}if(o.subject.id===null){alert("\u0412\u044B\u0431\u0435\u0440\u0438\u0442\u0435 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u044E\u0449\u0438\u0439 \u043E\u0441\u043D\u043E\u0432\u043D\u043E\u0439 \u043F\u0440\u0435\u0434\u043C\u0435\u0442");return}for(let t in o.subs)if(t.id===null){alert("\u0412\u044B\u0431\u0435\u0440\u0438\u0442\u0435 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u044E\u0449\u0438\u0435 \u043F\u0440\u0435\u0434\u043C\u0435\u0442\u044B");return}if(S(o.comment).length===0){alert("\u041F\u0435\u0440\u0435\u043F\u0440\u043E\u0432\u0435\u0440\u044C\u0442\u0435 \u0442\u0435\u043A\u0441\u0442 \u043E\u0442\u0437\u044B\u0432\u0430, \u043E\u043D \u043F\u0443\u0441\u0442\u043E\u0439");return}let e={teacher:o.teacher,subject:o.subject,subs:Array.from(o.subs.values()),text:o.comment};Xe(o.id,e).then(t=>{o=structuredClone(E),$()}).catch(t=>{alert(`\u0421\u0435\u0440\u0432\u0435\u0440 \u043E\u0442\u0432\u0435\u0442\u0438\u043B ${t}`)})}function Ze(e){o.id===null&&alert("Suggestion id \u043F\u0443\u0441\u0442\u043E\u0439!"),confirm(`\u041E\u0442\u043A\u043B\u043E\u043D\u0438\u0442\u044C \u043E\u0442\u0437\u044B\u0432 (${e})?`)&&De(o.id,e).then(n=>{n.status!==e&&alert("\u0421\u0442\u0430\u0442\u0443\u0441 \u043D\u0435 \u0441\u043E\u0445\u0440\u0430\u043D\u0451\u043D"),$()}).catch(n=>{alert(`\u0421\u0435\u0440\u0432\u0435\u0440 \u043E\u0442\u0432\u0435\u0442\u0438\u043B ${n}`)})}function ie(e,t,n,r){!t.value||t.value.length<3||(t.controller?.abort(),t.controller=new AbortController,q(S(t.value),t.controller,t.type).then(i=>{e.container.innerHTML="",i.results.push({id:-1,title:"\u0414\u043E\u0431\u0430\u0432\u0438\u0442\u044C \u043D\u043E\u0432\u044B\u0439",type:"add"});let s=k(i,(a,c,l)=>{r(e,t,n,a,c,l)});s?e.container.appendChild(s):e.container.innerHTML=j}).catch(i=>{if(e.container.innerHTML=P(i),i===404){let a=k({results:[{id:-1,title:"\u0414\u043E\u0431\u0430\u0432\u0438\u0442\u044C \u043D\u043E\u0432\u044B\u0439",type:"add"}]},(c,l,m)=>{r(e,t,n,c,l,m)});a&&e.container.appendChild(a)}}))}function et(e,t,n,r,i,s){if(e.container.innerHTML="",!(i!==t.type&&i!=="add")){if(i==="add"){let a=S(t.value);if(a.length===0)return;n.id=null,n.title=a}else n.id=r,n.title=s;ae(e,n)}}function ae(e,t){if(t.title===null){e.status.innerHTML="\u041D\u0438\u0447\u0435\u0433\u043E \u043D\u0435 \u0432\u044B\u0431\u0440\u0430\u043D\u043E";return}t.id===null&&(e.status.innerHTML=`\u0414\u043E\u0431\u0430\u0432\u043B\u0435\u043D \u043D\u043E\u0432\u044B\u0439: <span class="normal-text">${t.title}</span>`),e.status.innerHTML=`\u0412\u044B\u0431\u0440\u0430\u043D: <span class="normal-text">${t.title}</span>`,e.input.value="",e.input.placeholder=t.title}function wt(e,t,n,r,i,s){e.container.innerHTML="",!(i!==t.type&&i!=="add")&&(i==="add"&&(r=null,s=t.value),n.set(s,{id:r,title:s}),oe(e,n))}function oe(e,t){if(t.size===0){e.status.innerHTML='<p class="add-rev-status">\u041D\u0438\u0447\u0435\u0433\u043E \u043D\u0435 \u0432\u044B\u0431\u0440\u0430\u043D\u043E</p>';return}let n=document.createElement("div");n.classList.add("rev-list"),n.innerHTML=`
        <div class="rev-list">
            <p class="rev-list-title">\u0412\u044B\u0431\u0440\u0430\u043D\u043E: </p>
            ${Array.from(t,([r,i])=>`
                <div class="rev-list-item">
                    ${i.id===null?'<span class="muted-text">(\u043D\u043E\u0432\u044B\u0439)</span>':""}
                    ${i.title}
                    <button class="rev-list-item-reset" data-id="${r}">&times;</button>
                </div>
            `).join("")}
        </div>
    `,e.status.innerHTML="",e.status.appendChild(n)}function Mt(e,t){e.input.value=t}function Ht(e){o=structuredClone(E),tt(e)}function tt(e){ae(e.teacher,o.teacher),ae(e.subject,o.subject),oe(e.subs,o.subs),Mt(e.comment,o.comment)}function nt(e,t){let n=document.createElement("div");return n.classList.add("suggestions-list"),t.items.forEach(r=>{let i=document.createElement("div");i.className="suggestions-list-item",i.innerHTML=`
            \u041E\u0442\u0437\u044B\u0432 <b>\u2116${r.id}</b> \u0432 \u0441\u0442\u0430\u0442\u0443\u0441\u0435 <b>${Ce[r.status]??"\u043D\u0435\u043F\u043E\u043D\u044F\u0442\u043D\u043E\u043C"}</b> </br>
            <span class="muted-text">${r.title}</span>
        `,i.addEventListener("click",async()=>e(r.id)),n.appendChild(i)}),n}var T,w,d,u,y,rt,it,_,ct,p="dashboard",A=!1,M=!1,st,le;function ot(e,t=void 0){_=t,ct=e,u=document.querySelector("#reviews-status-box"),w=document.querySelector("#reviews-isu-box"),d=document.querySelector("#reviews-container"),y=document.querySelector("#reviews-input"),rt=document.querySelector("#reviews-input-reset"),it=document.querySelector("#reviews-menu"),T=document.querySelector("#reviews-header"),rt.addEventListener("click",()=>{y.value="",y.focus(),h()}),it.addEventListener("click",h),y.addEventListener("input",at),y.addEventListener("keydown",n=>{n.key==="Enter"&&at()})}function h(){p="dashboard",T.innerHTML=I,u.innerHTML="",d.innerHTML="",d.appendChild(Ee(A,M,ct,lt,St,de))}function ue(){p="login",T.innerHTML=ke,d.innerHTML="",d.appendChild(Ve(_))}function pe(e){A=!0,w.innerHTML=ge(e?.isu,e?.name),_!==void 0&&w.removeEventListener("click",ue),h(),Oe().then(t=>{t?.access&&(M=!0,console.log("You are moderator: ",M),h())}).catch(()=>{})}function O(e){A=!1,M=!1,w.innerHTML=e,_!==void 0&&(w.removeEventListener("click",ue),w.addEventListener("click",ue)),h()}function at(){p="search",clearTimeout(st),st=setTimeout(kt,300)}async function kt(){let e=y.value.trim();if(e){if(e.length<3){u.innerHTML=fe;return}}else{u.innerHTML="";return}u.innerHTML=U,le?.abort(),le=new AbortController,q(e,le).then(t=>{if(p!=="search")return;T.innerHTML=I;let n=k(t,(r,i)=>{p==="search"&&lt(r,i)});n?(u.innerHTML="",d.innerHTML="",d.appendChild(n)):(d.innerHTML="",u.innerHTML=j)}).catch(t=>{p==="search"&&(T.innerHTML=I,d.innerHTML="",u.innerHTML=P(t))})}async function lt(e,t){switch(p="reviews",u.innerHTML=U,t){case"teacher":Re(e).then(n=>{let r=Ke(n,A);if(p==="reviews"){if(r!==null){u.innerHTML="",d.innerHTML="",d.appendChild(r);return}u.innerHTML=G,p="search"}}).catch(n=>{u.innerHTML=X(n),p="search"});break;case"subject":Be(e).then(n=>{let r=Ye(n,A);if(p==="reviews"){if(r!==null){u.innerHTML="",d.innerHTML="",d.appendChild(r);return}u.innerHTML=G,p="search"}}).catch(n=>{u.innerHTML=X(n),p="search"});break;default:console.error(`\u041D\u0435\u0438\u0437\u0432\u0435\u0441\u0442\u043D\u044B\u0439 type ${t}`),u.innerHTML=ve,p="search"}}function St(){p="add-review",T.innerHTML=Se,u.innerHTML="",d.innerHTML="",d.appendChild(ce(h))}function de(){M&&(p="moderator",T.innerHTML=J,u.innerHTML="\u0417\u0430\u0433\u0440\u0443\u0437\u043A\u0430 \u043F\u0440\u0435\u0434\u043B\u043E\u0436\u043A\u0438...",d.innerHTML="",Fe().then(e=>{p==="moderator"&&(u.innerHTML="",e.items.length===0&&(u.innerHTML="\u041F\u0440\u0435\u0434\u043B\u043E\u0436\u043A\u0430 \u043F\u0443\u0441\u0442\u0430 =)"),d.innerHTML="",d.appendChild(nt(Ct,e)))}).catch(e=>{u.innerHTML=`\u0421\u0435\u0440\u0432\u0435\u0440 \u043E\u0442\u0432\u0435\u0442\u0438\u043B ${e}`}))}function Ct(e){M&&(p="moderator-review",T.innerHTML=J,u.innerHTML="\u0417\u0430\u0433\u0440\u0443\u0437\u043A\u0430 \u043E\u0442\u0437\u044B\u0432\u0430...",Ge(e).then(t=>{u.innerHTML="",d.innerHTML="",d.appendChild(ce(de,t,!0))}).catch(t=>{de(),t===404&&(u.innerHTML="\u041D\u0435\u0442 \u0442\u0430\u043A\u043E\u0433\u043E \u043E\u0442\u0437\u044B\u0432\u0430 \u0432 \u043F\u0440\u0435\u0434\u043B\u043E\u0436\u043A\u0435 =("),u.innerHTML=`\u0421\u0435\u0440\u0432\u0435\u0440 \u043E\u0442\u0432\u0435\u0442\u0438\u043B ${t}`}))}var me="<a>\u0412\u0445\u043E\u0434</a>",$t="\u0412\u044B \u0442\u043E\u0447\u043D\u043E \u0445\u043E\u0442\u0438\u0442\u0435 \u0432\u044B\u0439\u0442\u0438 \u0438\u0437 \u0430\u043A\u043A\u0430\u0443\u043D\u0442\u0430?";document.addEventListener("DOMContentLoaded",Et);async function Et(){ot(jt,At),W().then(e=>{pe(e)}).catch(()=>{O(me)})}function At(){W().then(e=>{pe(e),h()}).catch(()=>{O(me)})}function jt(){!Ae()||!confirm($t)||(Q(),O(me),h())}})();
//# sourceMappingURL=page.js.map

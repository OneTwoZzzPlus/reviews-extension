"use strict";(()=>{var R="\u0417\u0430\u0433\u0440\u0443\u0436\u0430\u0435\u043C...",B="<br/>(\u043E\u0431\u043D\u043E\u0432\u0438\u0442\u0435 \u0440\u0430\u0441\u0448\u0438\u0440\u0435\u043D\u0438\u0435/\u0441\u0430\u0439\u0442)",ce="\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0445\u043E\u0442\u044F \u0431\u044B 3 \u0441\u0438\u043C\u0432\u043E\u043B\u0430 =]",ue='<span class="error">\u041D\u0435 \u043F\u043E\u043D\u044F\u0442\u043D\u043E, \u0447\u0442\u043E \u044D\u0442\u043E \u0442\u0430\u043A\u043E\u0435 :|</span>'+B,q="\u041E\u0442\u0437\u044B\u0432\u044B \u043F\u0440\u0438\u0448\u043B\u0438 \u0441\u043B\u043E\u043C\u0430\u043D\u043D\u044B\u0435 =("+B,H="\u0420\u0435\u0437\u0443\u043B\u044C\u0442\u0430\u0442\u044B \u043F\u0440\u0438\u0448\u043B\u0438 \u0441\u043B\u043E\u043C\u0430\u043D\u043D\u044B\u0435 =("+B,le="\u041E\u0442\u0437\u044B\u0432\u044B \u043E\u0442\u0441\u0443\u0442\u0441\u0442\u0432\u0443\u044E\u0442 \\(O_o)/";function U(e){switch(e){case 0:return'<span class="error">\u0421\u0435\u0440\u0432\u0435\u0440 \u0441 \u043E\u0442\u0437\u044B\u0432\u0430\u043C\u0438 \u043D\u0435\u0434\u043E\u0441\u0442\u0443\u043F\u0435\u043D =(</span>';case 401:return"\u0421\u043D\u0430\u0447\u0430\u043B\u0430 \u0432\u043E\u0439\u0434\u0438\u0442\u0435, \u044D\u0442\u043E \u0431\u044B\u0441\u0442\u0440\u043E =)";case 404:return"\u041E\u0442\u0437\u044B\u0432\u044B \u043E\u0442\u0441\u0443\u0442\u0441\u0442\u0432\u0443\u044E\u0442 \\(O_o)/";default:return`\u0421\u0435\u0440\u0432\u0435\u0440 \u043F\u0440\u0438\u0441\u043B\u0430\u043B "${e}" \u0432\u043C\u0435\u0441\u0442\u043E \u043E\u0442\u0437\u044B\u0432\u043E\u0432 =(`}}function C(e){switch(e){case 0:return'<span class="error">\u0421\u0435\u0440\u0432\u0435\u0440 \u0441 \u043E\u0442\u0437\u044B\u0432\u0430\u043C\u0438 \u043D\u0435\u0434\u043E\u0441\u0442\u0443\u043F\u0435\u043D =(</span>';case 401:return"\u0421\u043D\u0430\u0447\u0430\u043B\u0430 \u0432\u043E\u0439\u0434\u0438\u0442\u0435, \u044D\u0442\u043E \u0431\u044B\u0441\u0442\u0440\u043E =)";case 404:return"\u041D\u0438\u0447\u0435\u0433\u043E \u043D\u0435 \u043D\u0430\u0439\u0434\u0435\u043D\u043E \\(O_o)/";default:return`\u0421\u0435\u0440\u0432\u0435\u0440 \u043F\u0440\u0438\u0441\u043B\u0430\u043B "${e}" \u0432\u043C\u0435\u0441\u0442\u043E \u0440\u0435\u0437\u0443\u043B\u044C\u0442\u0430\u0442\u043E\u0432 \u043F\u043E\u0438\u0441\u043A\u0430 =(`}}function de(e,t){return t?`${t} (${e})`:`${e}`}var pe={teacher:"\u{1F468}\u200D\u{1F3EB}",subject:"\u{1F4DA}",add:"\u2795"},me=`\u042D\u0442\u043E \u0430\u0432\u0442\u043E\u0440\u0438\u0437\u0430\u0446\u0438\u044F \u043F\u043E <b>ID.ITMO</b> \u0447\u0435\u0440\u0435\u0437 \u043F\u0440\u043E\u043A\u0441\u0438.<br/>
\u041D\u0430\u0436\u0438\u043C\u0430\u044F \u043A\u043D\u043E\u043F\u043A\u0443 "\u0412\u0445\u043E\u0434" \u0432\u044B \u0434\u0430\u0451\u0442\u0435 \u0441\u043E\u0433\u043B\u0430\u0441\u0438\u0435 \u043D\u0430 <b>\u043E\u0431\u0440\u0430\u0431\u043E\u0442\u043A\u0443 \u043F\u0435\u0440\u0441\u043E\u043D\u0430\u043B\u044C\u043D\u044B\u0445 \u0434\u0430\u043D\u043D\u044B\u0445</b>:<br/>
<i>\u0421\u0430\u0439\u0442 \u043E\u0431\u0440\u0430\u0431\u0430\u0442\u044B\u0432\u0430\u0435\u0442 \u0443\u043D\u0438\u043A\u0430\u043B\u044C\u043D\u044B\u0439 \u0438\u0434\u0435\u043D\u0442\u0438\u0444\u0438\u043A\u0430\u0442\u043E\u0440 \u043F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u0435\u043B\u044F (ISU) \u0434\u043B\u044F \u043F\u0440\u0435\u0434\u043E\u0442\u0432\u0440\u0430\u0449\u0435\u043D\u0438\u044F \u043D\u0430\u043A\u0440\u0443\u0442\u043E\u043A \u0438 \u043E\u0431\u0435\u0441\u043F\u0435\u0447\u0435\u043D\u0438\u044F \u0440\u0430\u0431\u043E\u0442\u044B \u0441\u0435\u0440\u0432\u0438\u0441\u0430. <br/>
\u0414\u0430\u043D\u043D\u044B\u0435 \u043D\u0435 \u043F\u0435\u0440\u0435\u0434\u0430\u044E\u0442\u0441\u044F \u0442\u0440\u0435\u0442\u044C\u0438\u043C \u043B\u0438\u0446\u0430\u043C. \u041F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u0435\u043B\u044C \u043C\u043E\u0436\u0435\u0442 \u0437\u0430\u043F\u0440\u043E\u0441\u0438\u0442\u044C \u0443\u0434\u0430\u043B\u0435\u043D\u0438\u0435 \u0441\u0432\u043E\u0438\u0445 \u0434\u0430\u043D\u043D\u044B\u0445.</i>
`,fe="\u041D\u0435\u0432\u0435\u0440\u043D\u044B\u0435 \u043B\u043E\u0433\u0438\u043D \u0438\u043B\u0438 \u043F\u0430\u0440\u043E\u043B\u044C!",he="\u041F\u0440\u043E\u0432\u0435\u0440\u044C\u0442\u0435 \u043B\u043E\u0433\u0438\u043D \u0438 \u043F\u0430\u0440\u043E\u043B\u044C! \u041F\u0440\u043E\u0446\u0435\u0441\u0441 \u0430\u0432\u0442\u043E\u0440\u0438\u0437\u0430\u0446\u0438\u0438 \u0431\u044B\u043B \u043D\u0430\u0440\u0443\u0448\u0435\u043D",O="\u0412\u0445\u043E\u0434",ve="\u0412\u0445\u043E\u0434 \u231B",be='<span class="error">\u{1F494} \u0412\u044B\u0439\u0442\u0438 \u0438\u0437 \u0430\u043A\u043A\u0430\u0443\u043D\u0442\u0430</span>',ge="\u{1F4DD} \u041D\u0430\u043F\u0438\u0441\u0430\u0442\u044C \u043E\u0442\u0437\u044B\u0432";var S="\u041F\u043E\u0438\u0441\u043A \u043E\u0442\u0437\u044B\u0432\u043E\u0432",Te="\u0412\u0445\u043E\u0434",Le="\u041D\u043E\u0432\u044B\u0439 \u043E\u0442\u0437\u044B\u0432";function xe(e,t,n){let r=document.createElement("div");r.classList.add("reviews-menu");let s=document.createElement("button");if(s.classList.add("reviews-menu-item"),s.innerHTML=ge,s.addEventListener("click",n),r.appendChild(s),e){let a=document.createElement("button");a.classList.add("reviews-menu-item"),a.innerHTML=be,a.addEventListener("click",t),r.appendChild(a)}return r}function k(e,t){let n=document.createElement("div");return n.className="search-list",e.results.forEach(r=>{let s=document.createElement("div");s.className="search-item",s.innerHTML=`
            ${pe[r.type]||""}
            ${r.title}
            <span class="search-id">${r.id}</span>
        `,s.addEventListener("click",async()=>t(r.id,r.type,r.title)),n.appendChild(s)}),n}function $(e){try{let t=e.split(".")[1].replace(/-/g,"+").replace(/_/g,"/"),n=atob(t),r=Uint8Array.from(n,a=>a.charCodeAt(0)),s=new TextDecoder("utf-8").decode(r);return JSON.parse(s)}catch(t){return console.error("\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0430\u0440\u0441\u0438\u043D\u0433\u0430 JWT",t),null}}function _(e){if(!e)return-1/0;let t=e.toLowerCase().match(/^до\s+(\d{4})$/);if(t){let[,c]=t;return new Date(Number(c),0,1,0,0).getTime()}let n=e.match(/(\d{2}):(\d{2})\s+(\d{2})\.(\d{2})\.(\d{4})/);if(!n)return-1/0;let[,r,s,a,i,o]=n;return new Date(Number(o),Number(i)-1,Number(a),Number(r),Number(s)).getTime()}function D(e,t,n={}){let{days:r=1,path:s="/",sameSite:a="Lax",secure:i=!1}=n,o=`${encodeURIComponent(e)}=${encodeURIComponent(t)}`;r&&(o+=`; max-age=${r*86400}`),o+=`; path=${s}`,o+=`; SameSite=${a}`,i&&(o+="; Secure"),document.cookie=o}function J(e){let t=document.cookie.split("; ").find(n=>n.startsWith(encodeURIComponent(e)+"="));return t?decodeURIComponent(t.split("=")[1]):null}var b=!1,h=null,f=null,E=0,Xe=300;function we(){return h!==null}function ye(e,t){h=e,f=t;let n=$(f);n?.exp&&(E=n.exp||0)}function ke(){return Date.now()>=E*1e3-Xe*1e3}function A(e){return $(e)?.isu?!0:(console.error("[AUTHP] isu not found"),!1)}function Ke(e,t){b=!0,chrome.runtime?.id&&chrome.storage.local.set({refresh_token:e,access_token:t},()=>{let n=chrome.runtime.lastError;n&&!n.message.includes("Extension context invalidated")?console.error(n):(ye(e,t),console.log("[AUTHP] tokens saved successfully"))})}function Ve(){b=!0,chrome.storage.local.remove(["refresh_token","access_token"]),h=null,f=null,E=0}function F(e,t){b=!1,D("refresh_token",e,{secure:!1}),D("access_token",t,{secure:!1})}function G(){return b=!1,new Promise((e,t)=>{let n=J("refresh_token"),r=J("access_token");if(n&&r){ye(n,r);let s=$(r);s?e(s):t()}else t()})}function X(){b=!1,document.cookie="refresh_token=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;",document.cookie="access_token=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;",h=null,f=null,E=0}function Me(e,t){b?Ke(e,t):F(e,t)}function He(){b?Ve():X()}async function L(e,t,n={},r=null){let s=new URL(t,"https://reviews.work.gd/"),a={method:e.toUpperCase(),headers:{"Content-Type":"application/json"},signal:r?.signal};if(h)try{if(!f||ke()){let i=new URL("/authp/refresh","https://reviews.work.gd/"),o=await fetch(i,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({refresh_token:h})});if(o.ok){let m=(await o.json())?.access_token;m&&A(m)&&Me(h,m)}else console.error("[API] Refresh status code "+o.status),He()}f&&(a.headers.token=f)}catch(i){console.error("[API] Unable to refresh the token",i)}return a.method==="GET"?Object.entries(n).forEach(([i,o])=>{s.searchParams.set(i,o.toString())}):a.body=JSON.stringify(n),new Promise((i,o)=>{fetch(s,a).then(async c=>{if(c.ok){console.log("[API] fetch resolved");let m=await c.text();i(m?JSON.parse(m):{})}else{let m=await c.json().catch(()=>({}));c.status===401||c.status===404?console.info("[API] error details:",m):console.error("[API] error details:",m),o(c.status)}}).catch(c=>{c.name!=="AbortError"?(console.error("[API] network error:",c),o(0)):console.log("[API] fetch aborted")})})}async function j(e,t,n=null){return console.log(`[API] send /search for "${e}"`),await L("GET","/search",n===null?{query:e}:{query:e,strainer:n},t)}async function Ce(e){return console.log(`[API] send /teacher for "${e}"`),await L("GET",`/teacher/${e}`,{})}async function Se(e){return console.log(`[API] send /subject for "${e}"`),await L("GET",`/subject/${e}`,{})}async function $e(e,t){return console.log(`[API] send /teacher/${e}/rate ${t}`),await L("POST",`/teacher/${e}/rate`,{user_rating:t})}async function K(e,t){return console.log(`[API] send /comment/${e}/vote ${t}`),await L("POST",`/comment/${e}/vote`,{user_karma:t})}async function Ee(e,t){return console.log("[API] send /authp/login"),await L("POST","/authp/login",{username:e,password:t})}function W(e){let t=document.createElement("div");t.classList.add("comments-wrap");let n=Ae(e);if(e.length>1){let r=ze(e);r.addEventListener("change",s=>{let a=parseInt(s.target.value);console.log(`[UI] sorting model ${a}`);let i=Ae(e,a);t.replaceChild(i,n),n=i}),t.appendChild(r)}return t.appendChild(n),t}function Ae(e,t=0){let n=document.createElement("div");return n.classList.add("comments"),Qe(e,t).map(s=>n.append(We(s))),n}function We(e){let t=document.createElement("div");return t.classList.add("comment"),t.innerHTML=`
        <div class="comment-head">
            \u041E\u0442\u0437\u044B\u0432 ${e.date}
            ${e?.subject?` \u043F\u043E \u043F\u0440\u0435\u0434\u043C\u0435\u0442\u0443 "${e.subject.title}"`:" "}
            ${e?.source?` \u0438\u0441\u0442\u043E\u0447\u043D\u0438\u043A "<a href="${e.source.link??""}">${e.source.title}</a>"`:""}
        </div>
        <div>${e.text}</div>
    `,t.appendChild(Ye(e.id,e.karma,e.user_karma)),t}function Ye(e,t,n){let r=document.createElement("div");r.classList.add("karma");let s=document.createElement("span");s.classList.add("karma-value");let a=document.createElement("button");a.classList.add("karma-btn");let i=document.createElement("button");return i.classList.add("karma-btn"),a.addEventListener("click",async o=>{let c=await K(e,n===1?0:1);n=c.user_karma,t=c.karma,V(s,a,i,t,n)}),i.addEventListener("click",async o=>{let c=await K(e,n===-1?0:-1);n=c.user_karma,t=c.karma,V(s,a,i,t,n)}),V(s,a,i,t,n),r.appendChild(a),r.appendChild(s),r.appendChild(i),r}function V(e,t,n,r,s){s==null&&(s=0),e.innerHTML=r,t.innerHTML=s===1?"\u25B2":"\u25B3",n.innerHTML=s===-1?"\u25BC":"\u25BD"}function ze(){let e=document.createElement("select");return e.name="sort",e.classList.add("comments-dropdown"),e.innerHTML=`
        <option value="0">C \u0432\u044B\u0441\u043E\u043A\u043E\u0439 \u043A\u0430\u0440\u043C\u044B</option>
        <option value="1">\u0421 \u043D\u0438\u0437\u043A\u043E\u0439 \u043A\u0430\u0440\u043C\u044B</option>
        <option value="2">\u0421\u043D\u0430\u0447\u0430\u043B\u0430 \u043D\u043E\u0432\u044B\u0435</option>
        <option value="3">\u0421\u043D\u0430\u0447\u0430\u043B\u0430 \u0441\u0442\u0430\u0440\u044B\u0435</option>`,e}function Qe(e,t=0){return[...e].sort((n,r)=>{let s=_(n.date),a=_(r.date),i;switch(t){case 0:return i=r.karma-n.karma,i===0?Number.isNaN(s)||Number.isNaN(a)?0:a-s:i;case 1:return i=n.karma-r.karma,i===0?Number.isNaN(s)||Number.isNaN(a)?0:a-s:i;case 2:return Number.isNaN(s)||Number.isNaN(a)?0:a-s;case 3:return Number.isNaN(s)||Number.isNaN(a)?0:s-a;default:return 0}})}function Y(e,t,n){let r=document.createElement("div");return r.classList.add("rating-box"),r.innerHTML=je(e,t,n),r.addEventListener("change",async s=>{if(s.target.name===`rating-${e}`){let a=parseInt(s.target.value),i=await $e(e,a);r.innerHTML=je(e,i.rating,i.user_rating)}}),r}function je(e,t,n){n==null&&(n=0);let r=[5,4,3,2,1].map(s=>`
        <input type="radio" id="rate-${e}-${s}" name="rating-${e}" value="${s}" ${n===s?"checked":""}>
        <label for="rate-${e}-${s}">\u2605</label>
    `).join("");return`
        <div class="rating-row">
            <span class="rating-title">\u0421\u0440\u0435\u0434\u043D\u044F\u044F \u043E\u0446\u0435\u043D\u043A\u0430:</span>
            <span class="rating-value">${t}</span>
        </div>
        <div class="rating-row">
            <span class="rating-title">\u0412\u0430\u0448\u0430 \u043E\u0446\u0435\u043D\u043A\u0430:</span>
            <div class="rating">${r}</div>
        </div>
    `}function z(e){let t=e.map(r=>`
        <div class="summary">
            <span class="summary-title">${r.title??""}</span>: 
            <span class="summary-value">${r.value??""}</span>
        </div>
    `).join(""),n=document.createElement("div");return n.classList.add("summaries"),n.innerHTML=t,n}function M(e){if(!e||!Array.isArray(e.summaries)||!Array.isArray(e.comments))return null;let t=document.createElement("div");if(t.classList.add("reviews-content-box"),t.appendChild(Y(e.id,e.rating,e?.user_rating)),e.summaries.length!==0&&t.appendChild(z(e.summaries)),e.comments.length!==0&&t.appendChild(W(e.comments)),e.summaries.length===0&&e.comments.length===0){let n=document.createElement("p");n.classList.add("comment"),n.innerHTML=le,t.appendChild(n)}return t}function Pe(e){let t=M(e);if(t===null)return null;let n=document.createElement("div");return n.innerHTML=`<h2>${e.name}</h2>`,n.appendChild(t),n}function Ne(e){if(!e||!Array.isArray(e.teachers))return null;e.teachers.sort((r,s)=>{let a=s.rating-r.rating;return a===0?s.id-r.id:a});let t=e.teachers.map(r=>M(r));if(t.some(r=>r===null))return null;let n=document.createElement("div");return n.innerHTML=`<h2>${e.title}</h2>`,e.teachers.forEach((r,s)=>{let a=document.createElement("details");a.innerHTML=`<summary class="reviews-title">${r.name}</summary>`,a.appendChild(t[s]),n.appendChild(a)}),n}function Ie(e){let t=document.createElement("form");t.classList.add("login-form"),t.innerHTML=`
        <p>${me}</p>
    
        <input type="email" name="email" placeholder="E-mail" required />
        <input type="password" name="password" placeholder="\u041F\u0430\u0440\u043E\u043B\u044C" required />
    
        <button id="authp-login" type="submit">\u0412\u0445\u043E\u0434</button>
    `;let n=t.querySelector("#authp-login");return t.addEventListener("submit",async r=>{r.preventDefault(),n.disabled=!0,n.innerHTML=ve,Ee(t.email.value,t.password.value).then(s=>{let a=s?.refresh_token,i=s?.access_token;if(!a||!i){console.error("[AUTHP] Invalid response",s),n.disabled=!1,n.innerHTML=O;return}A(i)&&(F(a,i),e())}).catch(s=>{alert(s===401?fe:he+` (\u0441\u0442\u0430\u0442\u0443\u0441 ${s})`),n.disabled=!1,n.innerHTML=O})}),t}var Q=64,ee=1e4,P=!1,Be={teacher:{id:null,title:null},subject:{id:null,title:null},subs:new Map,comment:null},v=Be;function qe(e=null,t=!1){P=t;let n=document.createElement("div");n.innerHTML=st();let r=rt(n);return Ze(n,r),e!==null&&(v=e),Ue(r,v),n}var p={teacher:{type:"teacher",controller:void 0,timeout:void 0,value:""},subject:{type:"subject",controller:void 0,timeout:void 0,value:""},subs:{type:"subject",controller:void 0,timeout:void 0,value:""}};function Ze(e,t){e.addEventListener("click",r=>{if(r.target===t.teacher.reset&&(t.teacher.input.value="",t.teacher.container.innerHTML=""),r.target===t.subject.reset&&(t.subject.input.value="",t.subject.container.innerHTML=""),r.target===t.subs.reset&&(t.subs.input.value="",t.subs.container.innerHTML=""),r.target.classList.contains("rev-list-item-reset")){let s=r.target.getAttribute("data-id");console.log(s),console.log("deleted? "+v.subs.delete(s)),ne(t.subs,v.subs)}r.target===t.cancel&&(P||nt()),r.target===t.submit&&alert("\u0423\u043F\u0441, \u0434\u043E\u0431\u0430\u0432\u043B\u0435\u043D\u0438\u0435 \u043E\u0442\u0437\u044B\u0432\u0430 \u0438 \u0435\u0433\u043E \u043C\u043E\u0434\u0435\u0440\u0430\u0446\u0438\u044F \u043F\u043E\u043A\u0430 \u043D\u0435 \u0440\u0435\u0430\u043B\u0438\u0437\u043E\u0432\u0430\u043D\u043E. \u0410 \u043F\u043E\u043A\u0430 \u0442\u0435\u0441\u0442\u0438\u0440\u0443\u0435\u043C \u0444\u043E\u0440\u043C\u0443 \u0438 \u043D\u0435 \u043E\u0441\u0443\u0436\u0434\u0430\u0435\u043C =)")});function n(r){if(r.target===t.comment.input){v.comment=t.comment.input.value;let s=t.comment.input.value.length;t.comment.counter.textContent=s.toString();let a=s>=ee;t.comment.input.classList.toggle("limit-exceeded",a),t.comment.counter.parentElement.classList.toggle("limit-exceeded",a);let i=window.scrollY;t.comment.input.style.height="auto",t.comment.input.style.height=t.comment.input.scrollHeight+"px",window.scrollTo(window.scrollX,i+1e3)}r.target===t.teacher.input&&(p.teacher.value=t.teacher.input.value,clearTimeout(p.teacher.timeout),p.teacher.timeout=setTimeout(()=>{Z(t.teacher,p.teacher,v.teacher,Re)},300)),r.target===t.subject.input&&(p.subject.value=t.subject.input.value,clearTimeout(p.subject.timeout),p.subject.timeout=setTimeout(()=>{Z(t.subject,p.subject,v.subject,Re)},300)),r.target===t.subs.input&&(p.subs.value=t.subs.input.value,clearTimeout(p.subs.timeout),p.subs.timeout=setTimeout(()=>{Z(t.subs,p.subs,v.subs,et)},300))}e.addEventListener("input",n),e.addEventListener("keydown",r=>{r.key==="Enter"&&n(r)})}function Z(e,t,n,r){!t.value||t.value.length<3||(t.controller?.abort(),t.controller=new AbortController,j(t.value,t.controller,t.type).then(s=>{e.container.innerHTML="",s.results.push({id:-1,title:"\u0414\u043E\u0431\u0430\u0432\u0438\u0442\u044C \u043D\u043E\u0432\u044B\u0439",type:"add"});let a=k(s,(i,o,c)=>{r(e,t,n,i,o,c)});a?e.container.appendChild(a):e.container.innerHTML=H}).catch(s=>{if(e.container.innerHTML=C(s),s===404){let i=k({results:[{id:-1,title:"\u0414\u043E\u0431\u0430\u0432\u0438\u0442\u044C \u043D\u043E\u0432\u044B\u0439",type:"add"}]},(o,c,m)=>{r(e,t,n,o,c,m)});i&&e.container.appendChild(i)}}))}function Re(e,t,n,r,s,a){e.container.innerHTML="",!(s!==t.type&&s!=="add")&&(s==="add"?(n.id=null,n.title=t.value):(n.id=r,n.title=a),te(e,n))}function te(e,t){if(t.title===null){e.status.innerHTML="\u041D\u0438\u043A\u043E\u0433\u043E \u043D\u0435 \u0432\u044B\u0431\u0440\u0430\u043D\u043E";return}t.id===null&&(e.status.innerHTML=`\u0414\u043E\u0431\u0430\u0432\u043B\u0435\u043D \u043D\u043E\u0432\u044B\u0439: <span class="normal-text">${t.title}</span>`),e.status.innerHTML=`\u0412\u044B\u0431\u0440\u0430\u043D: <span class="normal-text">${t.title}</span>`,e.input.value="",e.input.placeholder=t.title}function et(e,t,n,r,s,a){e.container.innerHTML="",!(s!==t.type&&s!=="add")&&(s==="add"&&(r=null,a=t.value),n.set(a,{id:r,title:a}),ne(e,n))}function ne(e,t){if(console.log(t),t.size===0){e.status.innerHTML='<p class="add-rev-status">\u041D\u0438\u0447\u0435\u0433\u043E \u043D\u0435 \u0432\u044B\u0431\u0440\u0430\u043D\u043E</p>';return}let n=document.createElement("div");n.classList.add("rev-list"),n.innerHTML=`
        <div class="rev-list">
            <p class="rev-list-title">\u0412\u044B\u0431\u0440\u0430\u043D\u043E: </p>
            ${Array.from(t,([r,s])=>`
                <div class="rev-list-item">
                    ${s.id===null?'<span class="muted-text">(\u043D\u043E\u0432\u044B\u0439)</span>':""}
                    ${s.title}
                    <button class="rev-list-item-reset" data-id="${r}">&times;</button>
                </div>
            `).join("")}
        </div>
    `,e.status.innerHTML="",e.status.appendChild(n)}function tt(e,t){e.textContent=t}function nt(e,t){t=Be,Ue(e,t)}function Ue(e,t){te(e.teacher,t.teacher),te(e.subject,t.subject),ne(e.subs,t.subs),tt(e.comment,t.comment)}function rt(e){return{teacher:{input:e.querySelector("#addrev-teacher-input"),reset:e.querySelector("#addrev-teacher-input-reset"),container:e.querySelector("#addrev-teacher-container"),status:e.querySelector("#addrev-teacher-status")},subject:{input:e.querySelector("#addrev-subject-input"),reset:e.querySelector("#addrev-subject-input-reset"),container:e.querySelector("#addrev-subject-container"),status:e.querySelector("#addrev-subject-status")},subs:{input:e.querySelector("#addrev-sub-input"),reset:e.querySelector("#addrev-sub-input-reset"),container:e.querySelector("#addrev-sub-container"),status:e.querySelector("#addrev-sub-status")},comment:{input:e.querySelector("#addrev-comment-input"),counter:e.querySelector("#addrev-comment-char-count")},submit:e.querySelector("#addrev-commit"),cancel:e.querySelector("#addrev-cancel")}}function st(){return`
        <p class="add-rev-label">* \u0414\u043E\u0431\u0430\u0432\u043B\u0435\u043D\u0438\u0435 \u043D\u043E\u0432\u043E\u0433\u043E \u043E\u0442\u0437\u044B\u0432\u0430, \u0434\u043B\u044F \u043F\u0440\u0435\u043F\u043E\u0434\u0430\u0432\u0430\u0442\u0435\u043B\u044F...</p>
        <div id="addrev-teacher-input-wrapper" class="rev-input-wrapper">
            <label for="addrev-teacher-input">\u0424\u0418\u041E \u043F\u0440\u0435\u043F\u043E\u0434\u0430\u0432\u0430\u0442\u0435\u043B\u044F</label>
            <input type="text" id="addrev-teacher-input" class="rev-input" 
                placeholder="\u0418\u0432\u0430\u043D\u043E\u0432 \u0418\u0432\u0430\u043D \u0418\u0432\u0430\u043D\u043E\u0432\u0438\u0447" 
                maxlength="${Q}"/>
            <button type="reset" id="addrev-teacher-input-reset" class="rev-input-reset">&times;</button>
        </div>
        <div id="addrev-teacher-container"></div>
        <p id="addrev-teacher-status" class="add-rev-status">\u041D\u0438\u043A\u043E\u0433\u043E \u043D\u0435 \u0432\u044B\u0431\u0440\u0430\u043D\u043E</p>
        
        <p class="add-rev-label">* \u041F\u043E \u043A\u0430\u043A\u043E\u043C\u0443 \u043F\u0440\u0435\u0434\u043C\u0435\u0442\u0443 \u0432\u044B \u0435\u0433\u043E \u0437\u043D\u0430\u0435\u0442\u0435? <i>(\u0412\u044B\u0431\u0435\u0440\u0438\u0442\u0435 \u043E\u0441\u043D\u043E\u0432\u043D\u043E\u0439)</i></p>
        <div id="addrev-subject-input-wrapper" class="rev-input-wrapper">
            <label for="addrev-subject-input">\u041D\u0430\u0437\u0432\u0430\u043D\u0438\u0435 \u043F\u0440\u0435\u0434\u043C\u0435\u0442\u0430</label>
            <input type="text" id="addrev-subject-input" class="rev-input" 
            placeholder="\u041C\u0430\u0442\u0435\u043C\u0430\u0442\u0438\u0447\u0435\u0441\u043A\u0438\u0439 \u0430\u043D\u0430\u043B\u0438\u0437" 
            maxlength="${Q}"/>
            <button type="reset" id="addrev-subject-input-reset" class="rev-input-reset">&times;</button>
        </div>
        <div id="addrev-subject-container"></div>
        <p id="addrev-subject-status" class="add-rev-status">\u041D\u0438\u0447\u0435\u0433\u043E \u043D\u0435 \u0432\u044B\u0431\u0440\u0430\u043D\u043E</p>
        
        <p class="add-rev-label">\u041A\u0430\u043A\u0438\u0435 \u0435\u0449\u0435 \u043F\u0440\u0435\u0434\u043C\u0435\u0442\u044B \u0432\u0435\u0434\u0435\u0442? <i>(\u041E\u0442\u043C\u0435\u0442\u044C\u0442\u0435, \u0435\u0441\u043B\u0438 \u0437\u043D\u0430\u0435\u0442\u0435)</i></p>
        <div id="addrev-sub-input-wrapper" class="rev-input-wrapper">
            <label for="addrev-sub-input">\u041D\u0430\u0437\u0432\u0430\u043D\u0438\u0435 \u043F\u0440\u0435\u0434\u043C\u0435\u0442\u0430</label>
            <input type="text" id="addrev-sub-input" class="rev-input" 
                placeholder="\u0410\u043B\u0433\u0435\u0431\u0440\u0430" 
                maxlength="${Q}"/>
            <button type="reset" id="addrev-sub-input-reset" class="rev-input-reset">&times;</button>
        </div>
        <div id="addrev-sub-container"></div>
        <div id="addrev-sub-status">
            <p class="add-rev-status">\u041D\u0438\u0447\u0435\u0433\u043E \u043D\u0435 \u0432\u044B\u0431\u0440\u0430\u043D\u043E</p>
        </div>
                
        <p class="add-rev-label">
            * \u0427\u0442\u043E \u043C\u043E\u0436\u0435\u0442\u0435 \u043E \u043D\u0451\u043C \u0441\u043A\u0430\u0437\u0430\u0442\u044C? <br/>
            <i>\u041A\u0430\u043A \u043E\u0442\u043D\u043E\u0441\u0438\u0442\u044C\u0441\u044F \u043A \u0441\u0442\u0443\u0434\u0435\u043D\u0442\u0430\u043C? \u041A\u0430\u043A \u043F\u0440\u0435\u043F\u043E\u0434\u0430\u0451\u0442? \u0422\u0440\u0443\u0434\u043D\u043E \u043B\u0438 \u0437\u0430\u043A\u0440\u044B\u0442\u044C\u0441\u044F? \u0423\u043A\u0430\u0436\u0438\u0442\u0435 \u0443\u0440\u043E\u0432\u0435\u043D\u044C, \u0435\u0441\u043B\u0438 \u044D\u0442\u043E \u0430\u043D\u0433\u043B\u0438\u0439\u0441\u043A\u0438\u0439.</i>
        </p>
        <div class="comment-textarea-wrapper">
            <label for="addrev-comment-input">\u041A\u043E\u043C\u043C\u0435\u043D\u0442\u0430\u0440\u0438\u0439</label>
            <textarea
                    id="addrev-comment-input"
                    class="comment-input"
                    placeholder="\u041C\u043E\u0436\u043D\u043E \u043F\u0438\u0441\u0430\u0442\u044C \u043A\u0440\u0430\u0442\u043A\u043E (\u043E\u0431\u044B\u0447\u043D\u043E \u043F\u0438\u0448\u0443\u0442 3\u20135 \u043F\u0440\u0435\u0434\u043B\u043E\u0436\u0435\u043D\u0438\u0439)..."
                    maxlength="${ee}"
            ></textarea>
            <div class="comment-char-counter">
                <span id="addrev-comment-char-count">0</span>/${ee}
            </div>
        </div>
        <button id="addrev-commit" class="rev-button">
            ${P?"\u0414\u043E\u0431\u0430\u0432\u0438\u0442\u044C \u043E\u0442\u0437\u044B\u0432":"\u041E\u0442\u043F\u0440\u0430\u0432\u0438\u0442\u044C \u0430\u043D\u043E\u043D\u0438\u043C\u043D\u044B\u0439 \u043E\u0442\u0437\u044B\u0432"}
        </button>
        <div id="addrev-cancel" class="note">
            <a>${P?"\u041E\u0442\u043A\u043B\u043E\u043D\u0438\u0442\u044C \u043E\u0442\u0437\u044B\u0432":"\u041E\u0447\u0438\u0441\u0442\u0438\u0442\u044C"}</a>
        </div>
    `}var y,w,d,u,x,Oe,_e,N,Fe,l="dashboard",ae=!1,De,re;function Ge(e,t=void 0){N=t,Fe=e,u=document.querySelector("#reviews-status-box"),w=document.querySelector("#reviews-isu-box"),d=document.querySelector("#reviews-container"),x=document.querySelector("#reviews-input"),Oe=document.querySelector("#reviews-input-reset"),_e=document.querySelector("#reviews-menu"),y=document.querySelector("#reviews-header"),Oe.addEventListener("click",()=>{x.value="",x.focus(),g()}),_e.addEventListener("click",g),x.addEventListener("input",Je),x.addEventListener("keydown",n=>{n.key==="Enter"&&Je()})}function g(){l="dashboard",y.innerHTML=S,u.innerHTML="",d.innerHTML="",d.appendChild(xe(ae,Fe,ot))}function se(){l="login",y.innerHTML=Te,d.innerHTML="",d.appendChild(Ie(N))}function ie(e){ae=!0,w.innerHTML=de(e?.isu,e?.name),N!==void 0&&w.removeEventListener("click",se),g()}function I(e){ae=!1,w.innerHTML=e,N!==void 0&&(w.removeEventListener("click",se),w.addEventListener("click",se)),g()}function Je(){l="search",clearTimeout(De),De=setTimeout(at,300)}async function at(){let e=x.value.trim();if(e){if(e.length<3){u.innerHTML=ce;return}}else{u.innerHTML="";return}u.innerHTML=R,re?.abort(),re=new AbortController,j(e,re).then(t=>{if(l!=="search")return;y.innerHTML=S;let n=k(t,it);n?(u.innerHTML="",d.innerHTML="",d.appendChild(n)):(d.innerHTML="",u.innerHTML=H)}).catch(t=>{l==="search"&&(y.innerHTML=S,d.innerHTML="",u.innerHTML=C(t))})}async function it(e,t){if(l==="search")switch(l="reviews",u.innerHTML=R,t){case"teacher":Ce(e).then(n=>{let r=Pe(n);if(l==="reviews"){if(r!==null){u.innerHTML="",d.innerHTML="",d.appendChild(r);return}u.innerHTML=q,l="search"}}).catch(n=>{u.innerHTML=U(n),l="search"});break;case"subject":Se(e).then(n=>{let r=Ne(n);if(l==="reviews"){if(r!==null){u.innerHTML="",d.innerHTML="",d.appendChild(r);return}u.innerHTML=q,l="search"}}).catch(n=>{u.innerHTML=U(n),l="search"});break;default:console.error(`\u041D\u0435\u0438\u0437\u0432\u0435\u0441\u0442\u043D\u044B\u0439 type ${t}`),u.innerHTML=ue,l="search"}}function ot(){l="add-review",y.innerHTML=Le,u.innerHTML="",d.innerHTML="",d.appendChild(qe())}var oe="<a>\u0412\u0445\u043E\u0434</a>",ct="\u0412\u044B \u0442\u043E\u0447\u043D\u043E \u0445\u043E\u0442\u0438\u0442\u0435 \u0432\u044B\u0439\u0442\u0438 \u0438\u0437 \u0430\u043A\u043A\u0430\u0443\u043D\u0442\u0430?";document.addEventListener("DOMContentLoaded",ut);async function ut(){Ge(dt,lt),G().then(e=>{ie(e)}).catch(()=>{I(oe)})}function lt(){G().then(e=>{ie(e),g()}).catch(()=>{I(oe)})}function dt(){!we()||!confirm(ct)||(X(),I(oe),g())}})();
//# sourceMappingURL=page.js.map

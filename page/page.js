"use strict";(()=>{var K="\u0417\u0430\u0433\u0440\u0443\u0436\u0430\u0435\u043C...",V="<br/>(\u043E\u0431\u043D\u043E\u0432\u0438\u0442\u0435 \u0440\u0430\u0441\u0448\u0438\u0440\u0435\u043D\u0438\u0435/\u0441\u0430\u0439\u0442)",we="<br/>\u041F\u043E\u043F\u0440\u043E\u0431\u0443\u0439\u0442\u0435 \u0435\u0449\u0451 \u0440\u0430\u0437 (\u043F\u0440\u043E\u0432\u0435\u0440\u044C\u0442\u0435 \u043F\u043E\u0434\u043A\u043B\u044E\u0447\u0435\u043D\u0438\u0435 \u043A \u0441\u0435\u0442\u0438 \u0418\u043D\u0442\u0435\u0440\u043D\u0435\u0442, VPN, \u0430\u043D\u0442\u0438-DPI, \u043E\u0433\u0440\u0430\u043D\u0438\u0447\u0435\u043D\u0438\u044F \u043F\u0440\u043E\u0432\u0430\u0439\u0434\u0435\u0440\u0430)",Me="\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0445\u043E\u0442\u044F \u0431\u044B 3 \u0441\u0438\u043C\u0432\u043E\u043B\u0430 =]",ke='<span class="error">\u041D\u0435 \u043F\u043E\u043D\u044F\u0442\u043D\u043E, \u0447\u0442\u043E \u044D\u0442\u043E \u0442\u0430\u043A\u043E\u0435 :|</span>'+V,W="\u041E\u0442\u0437\u044B\u0432\u044B \u043F\u0440\u0438\u0448\u043B\u0438 \u0441\u043B\u043E\u043C\u0430\u043D\u043D\u044B\u0435 =("+V,R="\u0420\u0435\u0437\u0443\u043B\u044C\u0442\u0430\u0442\u044B \u043F\u0440\u0438\u0448\u043B\u0438 \u0441\u043B\u043E\u043C\u0430\u043D\u043D\u044B\u0435 =("+V,Se="\u041E\u0442\u0437\u044B\u0432\u044B \u043E\u0442\u0441\u0443\u0442\u0441\u0442\u0432\u0443\u044E\u0442 \\(O_o)/";function Z(e){switch(e){case 0:return'<span class="error">\u0421\u0435\u0440\u0432\u0435\u0440 \u0441 \u043E\u0442\u0437\u044B\u0432\u0430\u043C\u0438 \u043D\u0435\u0434\u043E\u0441\u0442\u0443\u043F\u0435\u043D =(</span>'+we;case 401:return"\u0421\u043D\u0430\u0447\u0430\u043B\u0430 \u0432\u043E\u0439\u0434\u0438\u0442\u0435, \u044D\u0442\u043E \u0431\u044B\u0441\u0442\u0440\u043E =)";case 404:return"\u041E\u0442\u0437\u044B\u0432\u044B \u043E\u0442\u0441\u0443\u0442\u0441\u0442\u0432\u0443\u044E\u0442 \\(O_o)/";default:return`\u0421\u0435\u0440\u0432\u0435\u0440 \u043F\u0440\u0438\u0441\u043B\u0430\u043B "${e}" \u0432\u043C\u0435\u0441\u0442\u043E \u043E\u0442\u0437\u044B\u0432\u043E\u0432 =(`}}function q(e){switch(e){case 0:return'<span class="error">\u0421\u0435\u0440\u0432\u0435\u0440 \u0441 \u043E\u0442\u0437\u044B\u0432\u0430\u043C\u0438 \u043D\u0435\u0434\u043E\u0441\u0442\u0443\u043F\u0435\u043D =(</span>'+we;case 401:return"\u0421\u043D\u0430\u0447\u0430\u043B\u0430 \u0432\u043E\u0439\u0434\u0438\u0442\u0435, \u044D\u0442\u043E \u0431\u044B\u0441\u0442\u0440\u043E =)";case 404:return"\u041D\u0438\u0447\u0435\u0433\u043E \u043D\u0435 \u043D\u0430\u0439\u0434\u0435\u043D\u043E \\(O_o)/";default:return`\u0421\u0435\u0440\u0432\u0435\u0440 \u043F\u0440\u0438\u0441\u043B\u0430\u043B "${e}" \u0432\u043C\u0435\u0441\u0442\u043E \u0440\u0435\u0437\u0443\u043B\u044C\u0442\u0430\u0442\u043E\u0432 \u043F\u043E\u0438\u0441\u043A\u0430 =(`}}function He(e,t){return t?`${t} (${e})`:`${e}`}var Ce={teacher:"\u{1F468}\u200D\u{1F3EB}",subject:"\u{1F4DA}",add:"\u2795"},je=`\u042D\u0442\u043E \u0430\u0432\u0442\u043E\u0440\u0438\u0437\u0430\u0446\u0438\u044F \u043F\u043E <b>ID.ITMO</b> \u0447\u0435\u0440\u0435\u0437 \u043F\u0440\u043E\u043A\u0441\u0438.<br/>
\u041D\u0430\u0436\u0438\u043C\u0430\u044F \u043A\u043D\u043E\u043F\u043A\u0443 "\u0412\u0445\u043E\u0434" \u0432\u044B \u0434\u0430\u0451\u0442\u0435 \u0441\u043E\u0433\u043B\u0430\u0441\u0438\u0435 \u043D\u0430 <b>\u043E\u0431\u0440\u0430\u0431\u043E\u0442\u043A\u0443 \u043F\u0435\u0440\u0441\u043E\u043D\u0430\u043B\u044C\u043D\u044B\u0445 \u0434\u0430\u043D\u043D\u044B\u0445</b>:<br/>
<i>\u0421\u0430\u0439\u0442 \u043E\u0431\u0440\u0430\u0431\u0430\u0442\u044B\u0432\u0430\u0435\u0442 \u0443\u043D\u0438\u043A\u0430\u043B\u044C\u043D\u044B\u0439 \u0438\u0434\u0435\u043D\u0442\u0438\u0444\u0438\u043A\u0430\u0442\u043E\u0440 \u043F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u0435\u043B\u044F (ISU) \u0434\u043B\u044F \u043F\u0440\u0435\u0434\u043E\u0442\u0432\u0440\u0430\u0449\u0435\u043D\u0438\u044F \u043D\u0430\u043A\u0440\u0443\u0442\u043E\u043A \u0438 \u043E\u0431\u0435\u0441\u043F\u0435\u0447\u0435\u043D\u0438\u044F \u0440\u0430\u0431\u043E\u0442\u044B \u0441\u0435\u0440\u0432\u0438\u0441\u0430. <br/>
\u0414\u0430\u043D\u043D\u044B\u0435 \u043D\u0435 \u043F\u0435\u0440\u0435\u0434\u0430\u044E\u0442\u0441\u044F \u0442\u0440\u0435\u0442\u044C\u0438\u043C \u043B\u0438\u0446\u0430\u043C. \u041F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u0435\u043B\u044C \u043C\u043E\u0436\u0435\u0442 \u0437\u0430\u043F\u0440\u043E\u0441\u0438\u0442\u044C \u0443\u0434\u0430\u043B\u0435\u043D\u0438\u0435 \u0441\u0432\u043E\u0438\u0445 \u0434\u0430\u043D\u043D\u044B\u0445.</i>
`,$e="\u041D\u0435\u0432\u0435\u0440\u043D\u044B\u0435 \u043B\u043E\u0433\u0438\u043D \u0438\u043B\u0438 \u043F\u0430\u0440\u043E\u043B\u044C!",Ee="\u041F\u0440\u043E\u0432\u0435\u0440\u044C\u0442\u0435 \u043B\u043E\u0433\u0438\u043D \u0438 \u043F\u0430\u0440\u043E\u043B\u044C! \u041F\u0440\u043E\u0446\u0435\u0441\u0441 \u0430\u0432\u0442\u043E\u0440\u0438\u0437\u0430\u0446\u0438\u0438 \u0431\u044B\u043B \u043D\u0430\u0440\u0443\u0448\u0435\u043D",Q="\u0412\u0445\u043E\u0434",Ae="\u0412\u0445\u043E\u0434 \u231B",Pe='<span class="error">\u{1F494} \u0412\u044B\u0439\u0442\u0438 \u0438\u0437 \u0430\u043A\u043A\u0430\u0443\u043D\u0442\u0430</span>',Ne="\u{1F4DD} \u041D\u0430\u043F\u0438\u0441\u0430\u0442\u044C \u043E\u0442\u0437\u044B\u0432",Ie="\u{1F4CB} \u041C\u043E\u0434\u0435\u0440\u0430\u0446\u0438\u044F",B="\u041F\u043E\u0438\u0441\u043A \u043E\u0442\u0437\u044B\u0432\u043E\u0432",Re="\u0412\u0445\u043E\u0434",qe="\u041D\u043E\u0432\u044B\u0439 \u043E\u0442\u0437\u044B\u0432",_="\u041C\u043E\u0434\u0435\u0440\u0430\u0446\u0438\u044F",Be={delayed:"\u043D\u0430 \u0440\u0430\u0441\u0441\u043C\u043E\u0442\u0440\u0435\u043D\u0438\u0438",accepted:"\u043E\u043F\u0443\u0431\u043B\u0438\u043A\u043E\u0432\u0430\u043D",rejected:"\u043E\u0442\u043A\u043B\u043E\u043D\u0451\u043D"};function _e(){return`
        <div class="category">
            <h3 class="category-title">\u0410\u043D\u0433\u043B\u0438\u0439\u0441\u043A\u0438\u0439</h3>
            <div class="tiles-container">
                <div class="tile orange" data-id="101">A1</div>
                <div class="tile orange" data-id="102">A2</div>
                <div class="tile orange" data-id="103">B1.1</div>
                <div class="tile orange" data-id="104">B1.2</div>
                <div class="tile orange" data-id="105">B2</div>
                <div class="tile orange" data-id="106">C1</div>
                <div class="tile orange" data-id="107">C2</div>
            </div>
        </div>

        <div class="category">
            <h3 class="category-title">\u041E\u0431\u0449\u0438\u0435 \u043F\u0440\u0435\u0434\u043C\u0435\u0442\u044B</h3>
            <div class="tiles-container">
                <div class="tile green" data-id="35">\u0424\u0438\u0437\u043A\u0443\u043B\u044C\u0442\u0443\u0440\u0430</div>
                <div class="tile green" data-id="2">\u0424\u0438\u043B\u043E\u0441\u043E\u0444\u0438\u044F</div>
                <div class="tile green" data-id="9">\u041A\u043E\u043C\u043C\u0443\u043D\u0438\u043A\u0430\u0446\u0438\u0438 \u0438 \u043A\u043E\u043C\u0430\u043D\u0434\u043E\u043E\u0431\u0440\u0430\u0437\u043E\u0432\u0430\u043D\u0438\u0435</div>
                <div class="tile green" data-id="47">\u0422\u0435\u0445\u043D\u0438\u043A\u0438 \u043F\u0443\u0431\u043B\u0438\u0447\u043D\u044B\u0445 \u0432\u044B\u0441\u0442\u0443\u043F\u043B\u0435\u043D\u0438\u0439</div>
            </div>
        </div>

        <div class="category">
            <h3 class="category-title">\u041C\u0430\u0442\u0435\u043C\u0430\u0442\u0438\u043A\u0430</h3>
            <div class="tiles-container">
                <div class="tile red" data-id="10">\u041C\u0430\u0442\u0430\u043D\u0430\u043B\u0438\u0437</div>
                <div class="tile red" data-id="11">\u041C\u0430\u0442\u0430\u043D\u0430\u043B\u0438\u0437 (\u043F\u0440\u043E\u0434)</div>
                <div class="tile red" data-id="12">\u0410\u043B\u0433\u0435\u0431\u0440\u0430</div>
                <div class="tile red" data-id="13">\u0410\u043B\u0433\u0435\u0431\u0440\u0430 (\u043F\u0440\u043E\u0434)</div>
                <div class="tile red" data-id="14">\u0414\u0438\u0441\u043A\u0440\u0435\u0442\u043D\u0430\u044F \u043C\u0430\u0442\u0435\u043C\u0430\u0442\u0438\u043A\u0430</div>
                <div class="tile red" data-id="23">\u0422\u0435\u043E\u0440\u0432\u0435\u0440</div>
                <div class="tile red" data-id="24">\u041C\u0430\u0442\u0441\u0442\u0430\u0442</div>
                <div class="tile red" data-id="38">\u0414\u0413\u041C\u0410</div>
                <div class="tile red" data-id="39">\u0422\u0424\u041A\u041F</div>
                <div class="tile red" data-id="40">\u041E\u0441\u043D\u043E\u0432\u044B \u0442\u0435\u043E\u0440\u0438\u0438 \u0438\u0433\u0440</div>
                <div class="tile red" data-id="37">\u0414\u0438\u0444\u0444\u0435\u0440\u0435\u043D\u0446\u0438\u0430\u043B\u044C\u043D\u044B\u0435 \u0443\u0440\u0430\u0432\u043D\u0435\u043D\u0438\u044F</div>
                <div class="tile red" data-id="41">\u0427\u0438\u0441\u043B\u0435\u043D\u043D\u044B\u0435 \u043C\u0435\u0442\u043E\u0434\u044B \u043C\u043E\u0434\u0435\u043B\u0438\u0440\u043E\u0432\u0430\u043D\u0438\u044F</div>
            </div>
        </div>

        <div class="category">
            <h3 class="category-title">\u041F\u0418\u041D</h3>
            <div class="tiles-container">
                <div class="tile yellow" data-id="15">\u041F\u0440\u043E\u0433\u0440\u0430\u043C\u043C\u0438\u0440\u043E\u0432\u0430\u043D\u0438\u0435</div>
                <div class="tile yellow" data-id="16">\u0410\u043B\u0433\u043E\u0441\u044B</div>
                <div class="tile yellow" data-id="17">\u0418\u043D\u0444\u043E\u043A\u043E\u043C</div>
                <div class="tile yellow" data-id="19">\u041F\u0438\u0420\u0411\u0414</div>
                <div class="tile yellow" data-id="46">\u041E\u041E\u041F</div>
            </div>
        </div>

        <div class="category">
            <h3 class="category-title">\u0412\u0422</h3>
            <div class="tiles-container">
                <div class="tile purple" data-id="42">\u0414\u0438\u0441\u043A\u0440\u0435\u0442\u043A\u0430 (\u0431\u0430\u0437\u0430\xB3)</div>
                <div class="tile purple" data-id="43">\u0414\u0438\u0441\u043A\u0440\u0435\u0442\u043A\u0430 (\u043F\u0440\u043E\u0434)</div>
                <div class="tile purple" data-id="33">\u041E\u041F\u0414</div>
                <div class="tile purple" data-id="30">\u041F\u0440\u043E\u0433\u0440\u0430\u043C\u043C\u0438\u0440\u043E\u0432\u0430\u043D\u0438\u0435</div>
                <div class="tile purple" data-id="29">\u0418\u043D\u0444\u043E\u0440\u043C\u0430\u0442\u0438\u043A\u0430</div>
                <div class="tile purple" data-id="31">\u0411\u0414</div>
                <div class="tile purple" data-id="34">\u042F\u041F\u044B</div>
                <div class="tile purple" data-id="27">WEB</div>
                <div class="tile purple" data-id="32">\u0410\u041A</div>
                <div class="tile purple" data-id="26">\u0418\u0411</div>
            </div>
        </div>

        <div class="category">
            <h3 class="category-title">\u0418\u0441\u0442\u043E\u0440\u0438\u044F</h3>
            <div class="tiles-container">
                <div class="tile blue" data-id="8">\u0418\u0441\u0442\u043E\u0440\u0438\u044F \u0440\u0443\u0441\u0441\u043A\u043E\u0439 \u043A\u0443\u043B\u044C\u0442\u0443\u0440\u044B \u0432 \u043A\u043E\u043D\u0442\u0435\u043A\u0441\u0442\u0435 \u043C\u0438\u0440\u043E\u0432\u043E\u0439 \u043A\u0443\u043B\u044C\u0442\u0443\u0440\u044B</div>
                <div class="tile blue" data-id="7">\u0420\u043E\u0441\u0441\u0438\u044F \u0432 \u0438\u0441\u0442\u043E\u0440\u0438\u0438 \u0441\u043E\u0432\u0440\u0435\u043C\u0435\u043D\u043D\u044B\u0445 \u043C\u0435\u0436\u0434\u0443\u043D\u0430\u0440\u043E\u0434\u043D\u044B\u0445 \u043E\u0442\u043D\u043E\u0448\u0435\u043D\u0438\u0439</div>
                <div class="tile blue" data-id="4">\u0420\u0435\u0444\u043E\u0440\u043C\u044B \u0438 \u0440\u0435\u0444\u043E\u0440\u043C\u0430\u0442\u043E\u0440\u044B \u0432 \u0438\u0441\u0442\u043E\u0440\u0438\u0438 \u0420\u043E\u0441\u0441\u0438\u0438</div>
                <div class="tile blue" data-id="6">\u0418\u0441\u0442\u043E\u0440\u0438\u044F \u0440\u043E\u0441\u0441\u0438\u0439\u0441\u043A\u043E\u0439 \u043D\u0430\u0443\u043A\u0438 \u0438 \u0442\u0435\u0445\u043D\u0438\u043A\u0438</div>
                <div class="tile blue" data-id="5">\u0418\u0441\u0442\u043E\u0440\u0438\u044F \u0420\u043E\u0441\u0441\u0438\u0438 \u0438 \u043C\u0438\u0440\u0430 \u0432 \u0425\u0425 \u0432\u0435\u043A\u0435</div>
                <div class="tile blue" data-id="3">\u0421\u043E\u0446\u0438\u0430\u043B\u044C\u043D\u0430\u044F \u0438\u0441\u0442\u043E\u0440\u0438\u044F \u0420\u043E\u0441\u0441\u0438\u0438</div>
            </div>
        </div>

        <div class="category">
            <h3 class="category-title">\u041F\u0440\u0435\u0434\u043B\u043E\u0436\u0435\u043D\u0438\u044F? \u041F\u043E\u0436\u0435\u043B\u0430\u043D\u0438\u044F? \u0411\u0430\u0433\u0438?</h3>
            <a href="https://t.me/reviews_ext">\u041D\u0430\u043F\u0438\u0448\u0438\u0442\u0435 \u0432 \u0434\u0438\u0440\u0435\u043A\u0442 \u043A\u0430\u043D\u0430\u043B\u0430</a> \u0438\u043B\u0438
            <a href="https://github.com/OneTwoZzzPlus/reviews/issues">\u0432 issues github</a>
        </div>
    `}function Oe(e,t,n,i,r,s){let a=document.createElement("div");return a.appendChild(wt(e,t,n,r,s)),a.appendChild(Mt(i)),a}function wt(e,t,n,i,r){let s=document.createElement("div");s.classList.add("reviews-menu");let a=document.createElement("button");if(a.classList.add("reviews-menu-item"),a.innerHTML=Ne,a.addEventListener("click",i),s.appendChild(a),t){let o=document.createElement("button");o.classList.add("reviews-menu-item"),o.innerHTML=Ie,o.addEventListener("click",r),s.appendChild(o)}if(e){let o=document.createElement("button");o.classList.add("reviews-menu-item"),o.innerHTML=Pe,o.addEventListener("click",n),s.appendChild(o)}return s}function Mt(e){let t=document.createElement("div");return t.innerHTML=_e(),t.addEventListener("click",n=>{if(n.target.classList.contains("tile")){let i=n.target.getAttribute("data-id");e(i,"subject")}}),t}function E(e,t,n=!1){let i=document.createElement("div");return i.className="search-list",console.log(n),e.results.forEach(r=>{let s=document.createElement("div");s.className="search-item",s.innerHTML=`
            ${Ce[r.type]||""}
            ${r.title}
            ${n&&r.id!==null?`<span class="search-id">(${r.id})</span>`:""}
        `,s.addEventListener("click",async()=>t(r.id,r.type,r.title)),i.appendChild(s)}),i}function O(e){try{let t=e.split(".")[1].replace(/-/g,"+").replace(/_/g,"/"),n=atob(t),i=Uint8Array.from(n,s=>s.charCodeAt(0)),r=new TextDecoder("utf-8").decode(i);return JSON.parse(r)}catch(t){return console.error("\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0430\u0440\u0441\u0438\u043D\u0433\u0430 JWT",t),null}}function A(e){if(!e)return-1/0;let t=e.toLowerCase().match(/^до\s+(\d{4})$/);if(t){let[,l]=t;return new Date(Number(l),0,1,0,0).getTime()}let n=e.match(/(\d{2}):(\d{2})\s+(\d{2})\.(\d{2})\.(\d{4})/);if(!n)return-1/0;let[,i,r,s,a,o]=n;return new Date(Number(o),Number(a)-1,Number(s),Number(i),Number(r)).getTime()}function ee(e,t,n={}){let{days:i=1,path:r="/",sameSite:s="Lax",secure:a=!1}=n,o=`${encodeURIComponent(e)}=${encodeURIComponent(t)}`;i&&(o+=`; max-age=${i*86400}`),o+=`; path=${r}`,o+=`; SameSite=${s}`,a&&(o+="; Secure"),document.cookie=o}function te(e){let t=document.cookie.split("; ").find(n=>n.startsWith(encodeURIComponent(e)+"="));return t?decodeURIComponent(t.split("=")[1]):null}function b(e){return typeof e!="string"?"":e.normalize("NFKC").replace(/[\s\uFEFF\xA0]+/g," ").trim()}function k(e){return/^\d+$/.test(e)?parseInt(e,10):null}var S=!1,L=null,x=null,U=0,kt=300;function Ue(){return L!==null}function ne(e,t){L=e,x=t;let n=O(x);n?.exp&&(U=n.exp||0)}function Fe(){return Date.now()>=U*1e3-kt*1e3}function F(e){return O(e)?.isu?!0:(console.error("[AUTHP] isu not found"),!1)}function St(e,t){S=!0,chrome.runtime?.id&&chrome.storage.local.set({refresh_token:e,access_token:t},()=>{let n=chrome.runtime.lastError;n&&!n.message.includes("Extension context invalidated")?console.error(n):(ne(e,t),console.log("[AUTHP] tokens saved successfully"))})}function Ht(){S=!0,chrome.storage.local.remove(["refresh_token","access_token"]),L=null,x=null,U=0}function re(e,t){S=!1,ee("refresh_token",e,{secure:!1}),ee("access_token",t,{secure:!1}),ne(e,t)}function ie(){return S=!1,new Promise((e,t)=>{let n=te("refresh_token"),i=te("access_token");if(n&&i){ne(n,i);let r=O(i);r?e(r):t()}else t()})}function se(){S=!1,document.cookie="refresh_token=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;",document.cookie="access_token=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;",L=null,x=null,U=0}function De(e,t){S?St(e,t):re(e,t)}function ae(){S?Ht():se()}async function h(e,t,n={},i=null){let r=Object.keys(n).length>0;console.log(`[API] send ${e} ${t} ${r?`with options = ${JSON.stringify(n)}`:""}`);let s=new URL(t,"https://reviews.work.gd/"),a={method:e.toUpperCase(),headers:{"Content-Type":"application/json"},signal:i?.signal};if(L)try{if(!x||Fe()){console.log("[API] Refreshing token...");let o=new URL("/authp/refresh","https://reviews.work.gd/"),l=await fetch(o,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({refresh_token:L})});if(l.ok){let m=(await l.json())?.access_token;m&&F(m)?(De(L,m),console.log("[API] Token refreshed successfully")):(console.error("[API] Invalid token in refresh response"),ae())}else console.error("[API] Refresh failed with status:",l.status),ae()}x&&(a.headers.token=x)}catch(o){console.error("[API] Unable to refresh the token",o)}return a.method==="GET"?Object.entries(n).forEach(([o,l])=>{s.searchParams.set(o,l.toString())}):a.body=JSON.stringify(n),new Promise((o,l)=>{fetch(s,a).then(async f=>{if(f.ok){console.log(`[API] fetch resolved ${e} ${t}`);let m=await f.text();o(m?JSON.parse(m):{})}else{let m=await f.json().catch(()=>({}));f.status===401||f.status===404?console.info("[API] error details:",m):console.error("[API] error details:",m),l(f.status)}}).catch(f=>{f.name!=="AbortError"?(console.error("[API] network error:",f),l(0)):console.log(`[API] fetch aborted ${e} ${t}`)})})}async function D(e,t,n=null){return await h("GET","/search",n===null?{query:e}:{query:e,strainer:n},t)}async function Xe(e){return await h("GET",`/teacher/${e}`,{})}async function Ge(e){return await h("GET",`/subject/${e}`,{})}async function Je(e,t){return await h("POST",`/teacher/${e}/rate`,{user_rating:t})}async function ce(e,t){return await h("POST",`/comment/${e}/vote`,{user_karma:t})}async function ze(e){return await h("POST","/suggestion",e)}async function Ye(e,t){return await h("POST","/authp/login",{username:e,password:t})}async function Ke(){return await h("GET","/mod")}async function Ve(){return await h("GET","/mod/suggestion")}async function We(e){return await h("GET",`/mod/suggestion/${e}`)}async function Ze(e,t){return await h("POST",`/mod/suggestion/${e}/commit`,t)}async function Qe(e,t="rejected"){return await h("POST",`/mod/suggestion/${e}/cancel`,{status:t})}async function et(e){return await h("POST","/mod/teacher",e)}async function tt(e){return await h("POST","/mod/subject",e)}async function nt(e){return await h("POST","/mod/comment",e)}function le(e,t){let n=document.createElement("div");n.classList.add("comments-wrap");let i=rt(e,t);if(e.length>1){let r=$t(e);r.addEventListener("change",s=>{let a=parseInt(s.target.value);console.log(`[UI] sorting model ${a}`);let o=rt(e,t,a);n.replaceChild(o,i),i=o}),n.appendChild(r)}return n.appendChild(i),n}function rt(e,t,n=0){let i=document.createElement("div");return i.classList.add("comments"),Et(e,n).map(s=>i.append(Ct(s,t))),i}function Ct(e,t){let n=document.createElement("div");return n.classList.add("comment"),n.innerHTML=`
        <div class="comment-head">
            \u041E\u0442\u0437\u044B\u0432 ${e.date}
            ${e?.subject?` \u043F\u043E \u043F\u0440\u0435\u0434\u043C\u0435\u0442\u0443 "${e.subject.title}"`:" "}
            ${e?.source?` \u0438\u0441\u0442\u043E\u0447\u043D\u0438\u043A "<a href="${e.source.link??""}">${e.source.title}</a>"`:""}
        </div>
        <div>${e.text}</div>
    `,n.appendChild(jt(e.id,e.karma,e.user_karma,t)),n}function jt(e,t,n,i){let r=document.createElement("div");r.classList.add("karma");let s=document.createElement("span");s.classList.add("karma-value");let a=document.createElement("button");a.classList.add("karma-btn");let o=document.createElement("button");if(o.classList.add("karma-btn"),i){let l=!1;a.addEventListener("click",async f=>{if(!l)try{l=!0;let m=await ce(e,n===1?0:1);n=m.user_karma,t=m.karma,oe(s,a,o,t,n)}finally{l=!1}}),o.addEventListener("click",async f=>{if(!l)try{let m=await ce(e,n===-1?0:-1);n=m.user_karma,t=m.karma,oe(s,a,o,t,n)}finally{l=!1}})}else a.disabled=!0,o.disabled=!0;return oe(s,a,o,t,n),r.appendChild(a),r.appendChild(s),r.appendChild(o),r}function oe(e,t,n,i,r){r==null&&(r=0),e.innerHTML=i,t.innerHTML=r===1?"\u25B2":"\u25B3",n.innerHTML=r===-1?"\u25BC":"\u25BD"}function $t(){let e=document.createElement("select");return e.name="sort",e.classList.add("comments-dropdown"),e.innerHTML=`
        <option value="0">C \u0432\u044B\u0441\u043E\u043A\u043E\u0439 \u043A\u0430\u0440\u043C\u044B</option>
        <option value="1">\u0421 \u043D\u0438\u0437\u043A\u043E\u0439 \u043A\u0430\u0440\u043C\u044B</option>
        <option value="2">\u0421\u043D\u0430\u0447\u0430\u043B\u0430 \u043D\u043E\u0432\u044B\u0435</option>
        <option value="3">\u0421\u043D\u0430\u0447\u0430\u043B\u0430 \u0441\u0442\u0430\u0440\u044B\u0435</option>`,e}function Et(e,t=0){return[...e].sort((n,i)=>{let r=A(n.date),s=A(i.date),a;switch(t){case 0:return a=i.karma-n.karma,a===0?Number.isNaN(r)||Number.isNaN(s)?0:s-r:a;case 1:return a=n.karma-i.karma,a===0?Number.isNaN(r)||Number.isNaN(s)?0:s-r:a;case 2:return Number.isNaN(r)||Number.isNaN(s)?0:s-r;case 3:return Number.isNaN(r)||Number.isNaN(s)?0:r-s;default:return 0}})}function de(e,t,n,i){let r=document.createElement("div");r.classList.add("rating-box"),r.innerHTML=it(e,t,n,i);let s=!1;return r.addEventListener("change",async a=>{if(a.target.name===`rating-${e}`){if(s)return;let o=parseInt(a.target.value);try{s=!0;let l=await Je(e,o);r.innerHTML=it(e,l.rating,l.user_rating,i)}finally{s=!1}}}),r}function it(e,t,n,i){n==null&&(n=0);let r=[5,4,3,2,1].map(s=>`
        <input type="radio" 
            id="rate-${e}-${s}" 
            name="rating-${e}" 
            value="${s}" 
            ${n===s?"checked":""}
            ${i?"":"disabled"}>
        <label for="rate-${e}-${s}">\u2605</label>
    `).join("");return`
        <div class="rating-row">
            <span class="rating-title">\u0421\u0440\u0435\u0434\u043D\u044F\u044F \u043E\u0446\u0435\u043D\u043A\u0430:</span>
            <span class="rating-value">${t}</span>
        </div>
        <div class="rating-row">
            <span class="rating-title">\u0412\u0430\u0448\u0430 \u043E\u0446\u0435\u043D\u043A\u0430:</span>
            <div class="rating">${r}</div>
        </div>
    `}function ue(e){let t=e.map(i=>`
        <div class="summary">
            <span class="summary-title">${i.title??""}</span>: 
            <span class="summary-value">${i.value??""}</span>
        </div>
    `).join(""),n=document.createElement("div");return n.classList.add("summaries"),n.innerHTML=t,n}function P(e,t){if(!e||!Array.isArray(e.summaries)||!Array.isArray(e.comments))return null;let n=document.createElement("div");if(n.classList.add("reviews-content-box"),n.appendChild(de(e.id,e.rating,e?.user_rating,t)),e.summaries.length!==0&&n.appendChild(ue(e.summaries)),e.comments.length!==0&&n.appendChild(le(e.comments,t)),e.summaries.length===0&&e.comments.length===0){let i=document.createElement("p");i.classList.add("comment"),i.innerHTML=Se,n.appendChild(i)}return n}function st(e,t){let n=P(e,t);if(n===null)return null;let i=document.createElement("div");return i.innerHTML=`<h2>${e.name}</h2>`,i.appendChild(n),i}function at(e,t){if(!e||!Array.isArray(e.teachers))return null;e.teachers.sort((r,s)=>{let a=m=>!m.comments||m.comments.length===0?0:m.comments.reduce((xe,Lt)=>{let Le=k(A(Lt.date));return Le>xe?Le:xe},0),o=a(r),l=a(s);if(l!==o)return l-o;let f=s.rating-r.rating;return f!==0?f:s.id-r.id});let n=e.teachers.map(r=>P(r,t));if(n.some(r=>r===null))return null;let i=document.createElement("div");return i.innerHTML=`<h2>${e.title}</h2>`,e.teachers.forEach((r,s)=>{let a=document.createElement("details");a.innerHTML=`<summary class="reviews-title">${r.name}</summary>`,a.appendChild(n[s]),i.appendChild(a)}),i}function ct(e){let t=document.createElement("form");t.classList.add("login-form"),t.innerHTML=`
        <p>${je}</p>
    
        <input type="email" name="email" placeholder="E-mail" required />
        <input type="password" name="password" placeholder="\u041F\u0430\u0440\u043E\u043B\u044C" required />
    
        <button id="authp-login" type="submit">\u0412\u0445\u043E\u0434</button>
    `;let n=t.querySelector("#authp-login");return t.addEventListener("submit",async i=>{i.preventDefault(),n.disabled=!0,n.innerHTML=Ae,Ye(t.email.value,t.password.value).then(r=>{let s=r?.refresh_token,a=r?.access_token;if(!s||!a){console.error("[AUTHP] Invalid response",r),n.disabled=!1,n.innerHTML=Q;return}F(a)&&(re(s,a),e())}).catch(r=>{alert(r===401?$e:Ee+` (\u0441\u0442\u0430\u0442\u0443\u0441 ${r})`),n.disabled=!1,n.innerHTML=Q})}),t}function ot(e){return{teacher:{input:e.querySelector("#addrev-teacher-input"),reset:e.querySelector("#addrev-teacher-input-reset"),container:e.querySelector("#addrev-teacher-container"),status:e.querySelector("#addrev-teacher-status")},subject:{input:e.querySelector("#addrev-subject-input"),reset:e.querySelector("#addrev-subject-input-reset"),container:e.querySelector("#addrev-subject-container"),status:e.querySelector("#addrev-subject-status")},subs:{input:e.querySelector("#addrev-sub-input"),reset:e.querySelector("#addrev-sub-input-reset"),container:e.querySelector("#addrev-sub-container"),status:e.querySelector("#addrev-sub-status")},comment:{input:e.querySelector("#addrev-comment-input"),counter:e.querySelector("#addrev-comment-char-count")},submit:e.querySelector("#addrev-submit"),cancel:e.querySelector("#addrev-cancel"),exit:e.querySelector("#addrev-exit"),spam:e.querySelector("#addrev-spam"),ext:{source:e.querySelector("#addrev-source"),date:e.querySelector("#addrev-date")}}}function lt(e,t=!1){return e||(t=!1),`
        ${e||t?`<button id="addrev-exit" class="rev-button-s">
            \u041E\u0442\u043C\u0435\u043D\u0430
        </button>`:""}
        
        ${t?`<div class="mod-form" style="margin-top: 1rem;">
        <label for="addrev-source">ID \u0438\u0441\u0442\u043E\u0447\u043D\u0438\u043A\u0430</label>
        <input type="text" id="addrev-source" class="mod-row mod-input" placeholder="source_id"/>

        <label for="addrev-date">\u0414\u0430\u0442\u0430</label>
        <input type="text" id="addrev-date" class="mod-row mod-input" placeholder="HH:MM DD.MM.YYYY"/>
        </div>`:""}
        
        <p class="add-rev-label">* \u0414\u043E\u0431\u0430\u0432\u043B\u0435\u043D\u0438\u0435 \u043D\u043E\u0432\u043E\u0433\u043E \u043E\u0442\u0437\u044B\u0432\u0430, \u0434\u043B\u044F \u043F\u0440\u0435\u043F\u043E\u0434\u0430\u0432\u0430\u0442\u0435\u043B\u044F...</p>
        <div id="addrev-teacher-input-wrapper" class="rev-input-wrapper">
            <label for="addrev-teacher-input">\u0424\u0418\u041E \u043F\u0440\u0435\u043F\u043E\u0434\u0430\u0432\u0430\u0442\u0435\u043B\u044F</label>
            <input type="text" id="addrev-teacher-input" class="rev-input" 
                placeholder="\u0418\u0432\u0430\u043D\u043E\u0432 \u0418\u0432\u0430\u043D \u0418\u0432\u0430\u043D\u043E\u0432\u0438\u0447" 
                maxlength="64"/>
            <button type="reset" id="addrev-teacher-input-reset" class="rev-input-reset">&times;</button>
        </div>
        <div id="addrev-teacher-container"></div>
        <p id="addrev-teacher-status" class="add-rev-status">\u041D\u0438\u043A\u043E\u0433\u043E \u043D\u0435 \u0432\u044B\u0431\u0440\u0430\u043D\u043E</p>
        
        <p class="add-rev-label">* \u041F\u043E \u043A\u0430\u043A\u043E\u043C\u0443 \u043F\u0440\u0435\u0434\u043C\u0435\u0442\u0443 \u0432\u044B \u0435\u0433\u043E \u0437\u043D\u0430\u0435\u0442\u0435? <i>(\u0412\u044B\u0431\u0435\u0440\u0438\u0442\u0435 \u043E\u0441\u043D\u043E\u0432\u043D\u043E\u0439)</i></p>
        <div id="addrev-subject-input-wrapper" class="rev-input-wrapper">
            <label for="addrev-subject-input">\u041D\u0430\u0437\u0432\u0430\u043D\u0438\u0435 \u043F\u0440\u0435\u0434\u043C\u0435\u0442\u0430</label>
            <input type="text" id="addrev-subject-input" class="rev-input" 
            placeholder="\u041C\u0430\u0442\u0435\u043C\u0430\u0442\u0438\u0447\u0435\u0441\u043A\u0438\u0439 \u0430\u043D\u0430\u043B\u0438\u0437" 
            maxlength="64"/>
            <button type="reset" id="addrev-subject-input-reset" class="rev-input-reset">&times;</button>
        </div>
        <div id="addrev-subject-container"></div>
        <p id="addrev-subject-status" class="add-rev-status">\u041D\u0438\u0447\u0435\u0433\u043E \u043D\u0435 \u0432\u044B\u0431\u0440\u0430\u043D\u043E</p>
        
        <p class="add-rev-label">\u041A\u0430\u043A\u0438\u0435 \u0435\u0449\u0435 \u043F\u0440\u0435\u0434\u043C\u0435\u0442\u044B \u0432\u0435\u0434\u0435\u0442? <i>(\u041E\u0442\u043C\u0435\u0442\u044C\u0442\u0435, \u0435\u0441\u043B\u0438 \u0437\u043D\u0430\u0435\u0442\u0435)</i></p>
        <div id="addrev-sub-input-wrapper" class="rev-input-wrapper">
            <label for="addrev-sub-input">\u041D\u0430\u0437\u0432\u0430\u043D\u0438\u0435 \u043F\u0440\u0435\u0434\u043C\u0435\u0442\u0430</label>
            <input type="text" id="addrev-sub-input" class="rev-input" 
                placeholder="\u0410\u043B\u0433\u0435\u0431\u0440\u0430" 
                maxlength="64"/>
            <button type="reset" id="addrev-sub-input-reset" class="rev-input-reset">&times;</button>
        </div>
        <div id="addrev-sub-container"></div>
        <div id="addrev-sub-status">
            <p class="add-rev-status">\u041D\u0438\u0447\u0435\u0433\u043E \u043D\u0435 \u0432\u044B\u0431\u0440\u0430\u043D\u043E</p>
        </div>
                
        <p class="add-rev-label">
            * \u0427\u0442\u043E \u043C\u043E\u0436\u0435\u0442\u0435 \u043E \u043D\u0451\u043C \u0441\u043A\u0430\u0437\u0430\u0442\u044C? <br/>
            <i>\u041A\u0430\u043A \u043E\u0442\u043D\u043E\u0441\u0438\u0442\u044C\u0441\u044F \u043A \u0441\u0442\u0443\u0434\u0435\u043D\u0442\u0430\u043C? \u041A\u0430\u043A \u043F\u0440\u0435\u043F\u043E\u0434\u0430\u0451\u0442? \u0422\u0440\u0443\u0434\u043D\u043E \u043B\u0438 \u0437\u0430\u043A\u0440\u044B\u0442\u044C\u0441\u044F? \u0423\u043A\u0430\u0436\u0438\u0442\u0435 \u0443\u0440\u043E\u0432\u0435\u043D\u044C, \u0435\u0441\u043B\u0438 \u044D\u0442\u043E \u0430\u043D\u0433\u043B\u0438\u0439\u0441\u043A\u0438\u0439.</i>
        </p>
        <div class="comment-textarea-wrapper">
            <label for="addrev-comment-input">\u041A\u043E\u043C\u043C\u0435\u043D\u0442\u0430\u0440\u0438\u0439</label>
            <textarea
                    id="addrev-comment-input"
                    class="comment-input"
                    placeholder="\u041C\u043E\u0436\u043D\u043E \u043F\u0438\u0441\u0430\u0442\u044C \u043A\u0440\u0430\u0442\u043A\u043E (\u043E\u0431\u044B\u0447\u043D\u043E \u043F\u0438\u0448\u0443\u0442 3\u20135 \u043F\u0440\u0435\u0434\u043B\u043E\u0436\u0435\u043D\u0438\u0439)..."
                    maxlength="10000"
            ></textarea>
            <div class="comment-char-counter">
                <span id="addrev-comment-char-count">0</span>/10000
            </div>
        </div>
        
        ${e||t?`<button id="addrev-submit" class="rev-button">
            \u0414\u043E\u0431\u0430\u0432\u0438\u0442\u044C \u043E\u0442\u0437\u044B\u0432
        </button>`:`<button id="addrev-submit" class="rev-button">
            \u041E\u0442\u043F\u0440\u0430\u0432\u0438\u0442\u044C \u0430\u043D\u043E\u043D\u0438\u043C\u043D\u044B\u0439 \u043E\u0442\u0437\u044B\u0432
        </button>`}
        
        ${e&&!t?`<button id="addrev-cancel" class="rev-button-s">
            \u041E\u0442\u043A\u043B\u043E\u043D\u0438\u0442\u044C (\u043D\u0430\u0440\u0443\u0448\u0430\u0435\u0442 \u043F\u0440\u0430\u0432\u0438\u043B\u0430)
        </button>`:`<button id="addrev-cancel" class="rev-button-s">
            \u041E\u0447\u0438\u0441\u0442\u0438\u0442\u044C
        </button>`}
        
        ${e&&!t?`<button id="addrev-spam" class="rev-button-s">
            \u041E\u0442\u043F\u0440\u0430\u0432\u0438\u0442\u044C \u0432 \u0441\u043F\u0430\u043C
        </button>`:""}
    `}var H=!1,pe=!1,v=!1,N,C={id:null,teacher:{id:null,title:null},subject:{id:null,title:null},subs:new Map,comment:""},c=structuredClone(C);function X(e,t=null,n=!1,i=!1){pe=i?n:!1,H=n,N=e;let r=document.createElement("div");r.innerHTML=lt(H,pe);let s=ot(r);return Pt(r,s),t&&(c.id=t.id,c.teacher.id=t.teacher.id||null,c.teacher.title=t.teacher.title,c.subject.id=t.subject.id||null,c.subject.title=t.subject.title,c.comment=t.text,c.subs=new Map(t.subs.map(a=>[a.title,{id:a.id||null,title:a.title}]))),he(s),r}var g={teacher:{type:"teacher",controller:void 0,timeout:void 0,value:""},subject:{type:"subject",controller:void 0,timeout:void 0,value:""},subs:{type:"subject",controller:void 0,timeout:void 0,value:""}};function Pt(e,t){e.addEventListener("click",i=>{if(i.target===t.teacher.reset&&(t.teacher.input.value="",t.teacher.container.innerHTML=""),i.target===t.subject.reset&&(t.subject.input.value="",t.subject.container.innerHTML=""),i.target===t.subs.reset&&(t.subs.input.value="",t.subs.container.innerHTML=""),i.target.classList.contains("rev-list-item-reset")){let r=i.target.getAttribute("data-id");c.subs.delete(r),ve(t.subs,c.subs)}H?(pe?i.target===t.submit&&Nt(t):(i.target===t.submit&&Rt(),i.target===t.cancel&&dt("rejected"),i.target===t.spam&&dt("spam")),i.target===t.exit&&(c=structuredClone(C),N())):(i.target===t.submit&&It(),i.target===t.cancel&&_t(t))});function n(i){if(i.target===t.comment.input){c.comment=t.comment.input.value;let r=t.comment.input.value.length;t.comment.counter.textContent=r.toString();let s=r>=1e4;t.comment.input.classList.toggle("limit-exceeded",s),t.comment.counter.parentElement.classList.toggle("limit-exceeded",s);let a=window.scrollY;t.comment.input.style.height="auto",t.comment.input.style.height=t.comment.input.scrollHeight+"px",window.scrollTo(window.scrollX,a+1e3)}i.target===t.teacher.input&&(g.teacher.value=t.teacher.input.value,clearTimeout(g.teacher.timeout),g.teacher.timeout=setTimeout(()=>{me(t.teacher,g.teacher,c.teacher,ut)},300)),i.target===t.subject.input&&(g.subject.value=t.subject.input.value,clearTimeout(g.subject.timeout),g.subject.timeout=setTimeout(()=>{me(t.subject,g.subject,c.subject,ut)},300)),i.target===t.subs.input&&(g.subs.value=t.subs.input.value,clearTimeout(g.subs.timeout),g.subs.timeout=setTimeout(()=>{me(t.subs,g.subs,c.subs,qt)},300))}e.addEventListener("input",n),e.addEventListener("keydown",i=>{i.key==="Enter"&&n(i)})}function Nt(e){let t=k(b(e.ext.source.value));if(t===null){alert("\u0412\u0432\u0435\u0434\u0438\u0442\u0435 source_id");return}let n=b(e.ext.date.value);if(n===""){alert("\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u043D\u043E\u0440\u043C\u0430\u043B\u044C\u043D\u0443\u044E \u0434\u0430\u0442\u0443");return}if(c.teacher.id===null){alert("\u0412\u044B\u0431\u0435\u0440\u0438\u0442\u0435 \u043F\u0440\u0435\u043F\u043E\u0434\u0430\u0432\u0430\u0442\u0435\u043B\u044F");return}if(c.subject.id===null){alert("\u0412\u044B\u0431\u0435\u0440\u0438\u0442\u0435 \u043E\u0441\u043D\u043E\u0432\u043D\u043E\u0439 \u043F\u0440\u0435\u0434\u043C\u0435\u0442");return}if(b(c.comment).length===0){alert("\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0442\u0435\u043A\u0441\u0442 \u043E\u0442\u0437\u044B\u0432\u0430");return}let i={source_id:t,date:n,teacher:c.teacher,subject:c.subject,subs:Array.from(c.subs.values()),text:c.comment};v||(v=!0,nt(i).then(r=>{alert(`\u0414\u043E\u0431\u0430\u0432\u043B\u0435\u043D\u043E c id: ${r.id}`),c=structuredClone(C),e.ext.date.value="",he(e),v=!1}).catch(r=>{alert(`\u0421\u0435\u0440\u0432\u0435\u0440 \u043E\u0442\u0432\u0435\u0442\u0438\u043B ${r}`),v=!1}))}function It(){if(c.teacher.title===null){alert("\u041F\u043E\u0436\u0430\u043B\u0443\u0439\u0441\u0442\u0430, \u0432\u044B\u0431\u0435\u0440\u0438\u0442\u0435 \u043F\u0440\u0435\u043F\u043E\u0434\u0430\u0432\u0430\u0442\u0435\u043B\u044F =]");return}if(c.subject.title===null){alert("\u041F\u043E\u0436\u0430\u043B\u0443\u0439\u0441\u0442\u0430, \u0432\u044B\u0431\u0435\u0440\u0438\u0442\u0435 \u043E\u0441\u043D\u043E\u0432\u043D\u043E\u0439 \u043F\u0440\u0435\u0434\u043C\u0435\u0442 =]");return}if(b(c.comment).length===0){alert("\u041D\u0435 \u0441\u043B\u0438\u0448\u043A\u043E\u043C \u043B\u0438 \u043C\u0430\u043B\u043E \u0432\u044B \u043D\u0430\u043F\u0438\u0441\u0430\u043B\u0438?)");return}let e={teacher:c.teacher,subject:c.subject,subs:Array.from(c.subs.values()),text:c.comment};v||(v=!0,ze(e).then(t=>{c=structuredClone(C),alert("\u0421\u043F\u0430\u0441\u0438\u0431\u043E! \u041E\u0442\u0437\u044B\u0432 \u0431\u0443\u0434\u0435\u0442 \u043E\u043F\u0443\u0431\u043B\u0438\u043A\u043E\u0432\u0430\u043D \u043A\u0430\u043A \u0442\u043E\u043B\u044C\u043A\u043E \u043F\u0440\u043E\u0439\u0434\u0451\u0442 \u043C\u043E\u0434\u0435\u0440\u0430\u0446\u0438\u044E =)"),v=!1,N()}).catch(t=>{alert(`\u0421\u0435\u0440\u0432\u0435\u0440 \u043E\u0442\u0432\u0435\u0442\u0438\u043B ${t}`),v=!1}))}function Rt(){if(c.id===null&&alert("Suggestion id \u043F\u0443\u0441\u0442\u043E\u0439!"),c.teacher.id===null||c.teacher.id===void 0){alert("\u0412\u044B\u0431\u0435\u0440\u0438\u0442\u0435 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u044E\u0449\u0435\u0433\u043E \u043F\u0440\u0435\u043F\u043E\u0434\u0430\u0432\u0430\u0442\u0435\u043B\u044F");return}if(c.subject.id===null||c.subject.id===void 0){alert("\u0412\u044B\u0431\u0435\u0440\u0438\u0442\u0435 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u044E\u0449\u0438\u0439 \u043E\u0441\u043D\u043E\u0432\u043D\u043E\u0439 \u043F\u0440\u0435\u0434\u043C\u0435\u0442");return}for(let t in c.subs)if(t.id===null||t.id===void 0){alert("\u0412\u044B\u0431\u0435\u0440\u0438\u0442\u0435 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u044E\u0449\u0438\u0435 \u043F\u0440\u0435\u0434\u043C\u0435\u0442\u044B");return}if(b(c.comment).length===0){alert("\u041F\u0435\u0440\u0435\u043F\u0440\u043E\u0432\u0435\u0440\u044C\u0442\u0435 \u0442\u0435\u043A\u0441\u0442 \u043E\u0442\u0437\u044B\u0432\u0430, \u043E\u043D \u043F\u0443\u0441\u0442\u043E\u0439");return}let e={teacher:c.teacher,subject:c.subject,subs:Array.from(c.subs.values()),text:c.comment};v||(v=!0,Ze(c.id,e).then(t=>{c=structuredClone(C),N(),v=!1}).catch(t=>{alert(`\u0421\u0435\u0440\u0432\u0435\u0440 \u043E\u0442\u0432\u0435\u0442\u0438\u043B ${t}`),v=!1}))}function dt(e){c.id===null&&alert("Suggestion id \u043F\u0443\u0441\u0442\u043E\u0439!"),confirm(`\u041E\u0442\u043A\u043B\u043E\u043D\u0438\u0442\u044C \u043E\u0442\u0437\u044B\u0432 (${e})?`)&&(v||(v=!0,Qe(c.id,e).then(n=>{if(n.status!==e){alert("\u0421\u0442\u0430\u0442\u0443\u0441 \u043D\u0435 \u0441\u043E\u0445\u0440\u0430\u043D\u0451\u043D");return}N(),v=!1}).catch(n=>{alert(`\u0421\u0435\u0440\u0432\u0435\u0440 \u043E\u0442\u0432\u0435\u0442\u0438\u043B ${n}`),v=!1})))}function me(e,t,n,i){!t.value||t.value.length<3||(t.controller?.abort(),t.controller=new AbortController,D(b(t.value),t.controller,t.type).then(r=>{e.container.innerHTML="",r.results.push({id:null,title:"\u0414\u043E\u0431\u0430\u0432\u0438\u0442\u044C \u043D\u043E\u0432\u044B\u0439",type:"add"});let s=E(r,(a,o,l)=>{i(e,t,n,a,o,l)},H);s?e.container.appendChild(s):e.container.innerHTML=R}).catch(r=>{if(e.container.innerHTML=q(r),r===404){let a=E({results:[{id:null,title:"\u0414\u043E\u0431\u0430\u0432\u0438\u0442\u044C \u043D\u043E\u0432\u044B\u0439",type:"add"}]},(o,l,f)=>{i(e,t,n,o,l,f)},H);a&&e.container.appendChild(a)}}))}function ut(e,t,n,i,r,s){if(e.container.innerHTML="",!(r!==t.type&&r!=="add")){if(r==="add"){let a=b(t.value);if(a.length===0)return;n.id=null,n.title=a}else n.id=i,n.title=s;fe(e,n)}}function fe(e,t){if(t.title===null){e.status.innerHTML="\u041D\u0438\u0447\u0435\u0433\u043E \u043D\u0435 \u0432\u044B\u0431\u0440\u0430\u043D\u043E";return}t.id===null?e.status.innerHTML=`\u0414\u043E\u0431\u0430\u0432\u043B\u0435\u043D \u043D\u043E\u0432\u044B\u0439: <span class="normal-text">${t.title}</span>`:e.status.innerHTML=`
            \u0412\u044B\u0431\u0440\u0430\u043D: <span class="normal-text">${t.title} ${H?`<b>(${t.id})</b>`:""}</span>`,e.input.value="",e.input.placeholder=t.title}function qt(e,t,n,i,r,s){e.container.innerHTML="",!(r!==t.type&&r!=="add")&&(r==="add"&&(i=null,s=t.value),n.set(s,{id:i,title:s}),ve(e,n))}function ve(e,t){if(t.size===0){e.status.innerHTML='<p class="add-rev-status">\u041D\u0438\u0447\u0435\u0433\u043E \u043D\u0435 \u0432\u044B\u0431\u0440\u0430\u043D\u043E</p>';return}let n=document.createElement("div");n.classList.add("rev-list"),n.innerHTML=`
        <div class="rev-list">
            <p class="rev-list-title">\u0412\u044B\u0431\u0440\u0430\u043D\u043E: </p>
            ${Array.from(t,([i,r])=>`
                <div class="rev-list-item">
                    ${r.id===null?'<span class="muted-text">(\u043D\u043E\u0432\u044B\u0439)</span>':""}
                    ${r.title}
                    ${H&&r.id!==null?`(<b>${r.id}</b>)`:""}
                    <button class="rev-list-item-reset" data-id="${i}">&times;</button>
                </div>
            `).join("")}
        </div>
    `,e.status.innerHTML="",e.status.appendChild(n)}function Bt(e,t){e.input.value=t}function _t(e){c=structuredClone(C),he(e)}function he(e){fe(e.teacher,c.teacher),fe(e.subject,c.subject),ve(e.subs,c.subs),Bt(e.comment,c.comment)}function mt(e,t){let n=document.createElement("div");return n.classList.add("suggestions-list"),t.items.forEach(i=>{let r=document.createElement("div");r.className="suggestions-list-item",r.innerHTML=`
            \u041E\u0442\u0437\u044B\u0432 <b>\u2116${i.id}</b> \u0432 \u0441\u0442\u0430\u0442\u0443\u0441\u0435 <b>${Be[i.status]??"\u043D\u0435\u043F\u043E\u043D\u044F\u0442\u043D\u043E\u043C"}</b> </br>
            <span class="muted-text">${i.title}</span>
        `,r.addEventListener("click",async()=>e(i.id)),n.appendChild(r)}),n}function pt(e){return{teacher:{id:e.querySelector("#mod-teacher-id"),title:e.querySelector("#mod-teacher-title"),form:e.querySelector("#mod-teacher-form")},subject:{id:e.querySelector("#mod-subject-id"),title:e.querySelector("#mod-subject-title"),checkbox:e.querySelector("#mod-subject-checkbox"),form:e.querySelector("#mod-subject-form")}}}function ft(){return`<details>
        <summary>\u0414\u043E\u0431\u0430\u0432\u043B\u0435\u043D\u0438\u0435 \u043F\u0440\u0435\u043F\u043E\u0434\u0430\u0432\u0430\u0442\u0435\u043B\u044F</summary>
        <form class="mod-form" id="mod-teacher-form">
            <label for="mod-teacher-id">\u0418\u0421\u0423</label>
            <input type="text" id="mod-teacher-id" class="mod-row mod-input" placeholder="XXXXXX"/>

            <label for="mod-teacher-title">\u0424\u0418\u041E</label>
            <input type="text" id="mod-teacher-title" class="mod-row mod-input" placeholder="\u0424\u0418\u041E"/>

            <button type="submit" id="mod-teacher-submit" class="mod-row rev-button-s">\u0417\u0430\u0434\u0430\u0442\u044C</button>
        </form>
    </details>

    <details>
        <summary>\u0414\u043E\u0431\u0430\u0432\u043B\u0435\u043D\u0438\u0435 \u043F\u0440\u0435\u0434\u043C\u0435\u0442\u0430</summary>
        <form class="mod-form" id="mod-subject-form">
            <div class="mod-form-group">
                <label for="mod-subject-checkbox">\u043D\u043E\u0432\u044B\u0439</label>
                <input type="checkbox" id="mod-subject-checkbox"/>

                <label for="mod-subject-id">ID</label>
                <input type="text" id="mod-subject-id" class="mod-input" placeholder="\u0434\u043E\u0431\u0430\u0432\u0438\u0442\u044C \u043D\u043E\u0432\u044B\u0439" disabled/>
            </div>

            <label for="mod-subject-title">\u043D\u0430\u0437\u0432\u0430\u043D\u0438\u0435</label>
            <input type="text" id="mod-subject-title" class="mod-row mod-input" placeholder="\u043D\u0430\u0437\u0432\u0430\u043D\u0438\u0435"/>

            <button type="submit" id="mod-subject-submit" class="mod-row rev-button-s">\u0417\u0430\u0434\u0430\u0442\u044C</button>
        </form>
    </details>`}function G(){let e=document.createElement("div");e.classList.add("suggestions-list-item"),e.innerHTML=ft();let t=pt(e);return Ot(e,t),e}function Ot(e,t){e.addEventListener("input",r=>{r.target===t.subject.checkbox&&(t.subject.checkbox.checked?(t.subject.id.placeholder="id",t.subject.id.disabled=!1):(t.subject.id.value="",t.subject.id.placeholder="\u0434\u043E\u0431\u0430\u0432\u0438\u0442\u044C \u043D\u043E\u0432\u044B\u0439",t.subject.id.disabled=!0))});let n=!1,i=!1;e.addEventListener("submit",r=>{if(r.target===t.teacher.form){r.preventDefault();let s={id:k(b(t.teacher.id.value)),title:b(t.teacher.title.value)};if(s.id===null){alert("\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0418\u0421\u0423 \u043F\u0440\u0435\u043F\u043E\u0434\u0430\u0432\u0430\u0442\u0435\u043B\u044F");return}if(s.title===""){alert("\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0424\u0418\u041E \u043F\u0440\u0435\u043F\u043E\u0434\u0430\u0432\u0430\u0442\u0435\u043B\u044F");return}if(n)return;n=!0,et(s).then(a=>{alert(`\u041E\u0431\u043D\u043E\u0432\u043B\u0451\u043D \u0441 id: ${a.id}`),r.target.reset(),n=!1}).catch(a=>{alert(`\u0421\u0435\u0440\u0432\u0435\u0440 \u043E\u0442\u0432\u0435\u0442\u0438\u043B ${a}`),n=!1})}if(r.target===t.subject.form){r.preventDefault();let s={id:null,title:""};if(t.subject.checkbox.checked){if(s.id=k(b(t.subject.id.value)),s.title=b(t.subject.title.value),s.id===null){alert("\u0412\u0432\u0435\u0434\u0438\u0442\u0435 ID \u043F\u0440\u0435\u0434\u043C\u0435\u0442\u0430");return}if(s.title===""){alert("\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u043D\u0430\u0437\u0432\u0430\u043D\u0438\u0435 \u043F\u0440\u0435\u0434\u043C\u0435\u0442\u0430");return}}else if(s.id=null,s.title=b(t.subject.title.value),s.title===""){alert("\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u043D\u0430\u0437\u0432\u0430\u043D\u0438\u0435 \u043D\u043E\u0432\u043E\u0433\u043E \u043F\u0440\u0435\u0434\u043C\u0435\u0442\u0430");return}if(i)return;i=!0,tt(s).then(a=>{alert(`\u041E\u0431\u043D\u043E\u0432\u043B\u0451\u043D \u0441 id: ${a.id}`),r.target.reset(),i=!1}).catch(a=>{alert(`\u0421\u0435\u0440\u0432\u0435\u0440 \u043E\u0442\u0432\u0435\u0442\u0438\u043B ${a}`),i=!1})}})}var T,$,u,d,j,vt,ht,z,Tt,p="dashboard",I=!1,w=!1,bt,be;function yt(e,t=void 0){z=t,Tt=e,d=document.querySelector("#reviews-status-box"),$=document.querySelector("#reviews-isu-box"),u=document.querySelector("#reviews-container"),j=document.querySelector("#reviews-input"),vt=document.querySelector("#reviews-input-reset"),ht=document.querySelector("#reviews-menu"),T=document.querySelector("#reviews-header"),vt.addEventListener("click",()=>{j.value="",j.focus(),y()}),ht.addEventListener("click",y),j.addEventListener("input",gt),j.addEventListener("keydown",n=>{n.key==="Enter"&&gt()})}function y(){p="dashboard",T.innerHTML=B,d.innerHTML="",u.innerHTML="",u.appendChild(Oe(I,w,Tt,xt,Ft,J))}function ge(){p="login",T.innerHTML=Re,u.innerHTML="",u.appendChild(ct(z))}function Te(e){I=!0,$.innerHTML=He(e?.isu,e?.name),z!==void 0&&$.removeEventListener("click",ge),y(),Ke().then(t=>{t?.access&&(w=!0,console.log("You are moderator: ",w),y())}).catch(()=>{})}function Y(e){I=!1,w=!1,$.innerHTML=e,z!==void 0&&($.removeEventListener("click",ge),$.addEventListener("click",ge)),y()}function gt(){p="search",clearTimeout(bt),bt=setTimeout(Ut,300)}async function Ut(){let e=j.value.trim();if(e){if(e.length<3){d.innerHTML=Me;return}}else{d.innerHTML="";return}d.innerHTML=K,be?.abort(),be=new AbortController,D(e,be).then(t=>{if(p!=="search")return;T.innerHTML=B;let n=E(t,(i,r)=>{p==="search"&&xt(i,r)},w);n?(d.innerHTML="",u.innerHTML="",u.appendChild(n)):(u.innerHTML="",d.innerHTML=R)}).catch(t=>{p==="search"&&(T.innerHTML=B,u.innerHTML="",d.innerHTML=q(t))})}async function xt(e,t){switch(p="reviews",d.innerHTML=K,t){case"teacher":Xe(e).then(n=>{let i=st(n,I);if(p==="reviews"){if(i!==null){d.innerHTML="",u.innerHTML="",u.appendChild(i);return}d.innerHTML=W,p="search"}}).catch(n=>{d.innerHTML=Z(n),p="search"});break;case"subject":Ge(e).then(n=>{let i=at(n,I);if(p==="reviews"){if(i!==null){d.innerHTML="",u.innerHTML="",u.appendChild(i);return}d.innerHTML=W,p="search"}}).catch(n=>{d.innerHTML=Z(n),p="search"});break;default:console.error(`\u041D\u0435\u0438\u0437\u0432\u0435\u0441\u0442\u043D\u044B\u0439 type ${t}`),d.innerHTML=ke,p="search"}}function Ft(){p="add-review",T.innerHTML=qe,d.innerHTML="",u.innerHTML="",u.appendChild(X(y))}function J(){if(!w)return;p="moderator",T.innerHTML=_,d.innerHTML="\u0417\u0430\u0433\u0440\u0443\u0437\u043A\u0430 \u043F\u0440\u0435\u0434\u043B\u043E\u0436\u043A\u0438...",u.innerHTML="",u.appendChild(G());let e=document.createElement("button");e.classList.add("rev-button-s"),e.style.margin="0 0 0.5rem 0",e.innerHTML="\u0414\u043E\u0431\u0430\u0432\u0438\u0442\u044C \u0441\u0442\u043E\u0440\u043E\u043D\u043D\u0438\u0439 \u043E\u0442\u0437\u044B\u0432",e.addEventListener("click",Dt),u.appendChild(e),Ve().then(t=>{p==="moderator"&&(d.innerHTML="",t.items.length===0&&(d.innerHTML="\u041F\u0440\u0435\u0434\u043B\u043E\u0436\u043A\u0430 \u043F\u0443\u0441\u0442\u0430 =)"),u.appendChild(mt(Xt,t)))}).catch(t=>{d.innerHTML=`\u0421\u0435\u0440\u0432\u0435\u0440 \u043E\u0442\u0432\u0435\u0442\u0438\u043B ${t}`})}function Dt(){w&&(p="moderator-external",T.innerHTML=_,d.innerHTML="",u.innerHTML="",u.appendChild(G()),u.appendChild(X(J,null,!0,!0)))}function Xt(e){w&&(p="moderator-review",T.innerHTML=_,d.innerHTML="\u0417\u0430\u0433\u0440\u0443\u0437\u043A\u0430 \u043E\u0442\u0437\u044B\u0432\u0430...",We(e).then(t=>{d.innerHTML="",u.innerHTML="",u.appendChild(G()),u.appendChild(X(J,t,!0))}).catch(t=>{J(),t===404&&(d.innerHTML="\u041D\u0435\u0442 \u0442\u0430\u043A\u043E\u0433\u043E \u043E\u0442\u0437\u044B\u0432\u0430 \u0432 \u043F\u0440\u0435\u0434\u043B\u043E\u0436\u043A\u0435 =("),d.innerHTML=`\u0421\u0435\u0440\u0432\u0435\u0440 \u043E\u0442\u0432\u0435\u0442\u0438\u043B ${t}`}))}var ye="<a>\u0412\u0445\u043E\u0434</a>",Gt="\u0412\u044B \u0442\u043E\u0447\u043D\u043E \u0445\u043E\u0442\u0438\u0442\u0435 \u0432\u044B\u0439\u0442\u0438 \u0438\u0437 \u0430\u043A\u043A\u0430\u0443\u043D\u0442\u0430?";document.addEventListener("DOMContentLoaded",Jt);async function Jt(){yt(Yt,zt),ie().then(e=>{Te(e)}).catch(()=>{Y(ye)})}function zt(){ie().then(e=>{Te(e),y()}).catch(()=>{Y(ye)})}function Yt(){!Ue()||!confirm(Gt)||(se(),Y(ye),y())}})();
//# sourceMappingURL=page.js.map
